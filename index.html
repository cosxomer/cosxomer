<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cosxomer ders √ßizelgesi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ======================================= */
        /* TEMEL STƒ∞LLER VE TEMA DEƒûƒ∞≈ûKENLERƒ∞ */
        /* ======================================= */
        :root {
            --bg-color: #f0f2f5;
            --container-bg: #ffffff;
            --header-bg: #4a90e2;
            --header-text: #ffffff;
            --text-color: #333333;
            --border-color: #e0e0e0;
            --day-bg: #f8f8f8;
            --accent-color: #5c8e1a; /* Ye≈üil/Ba≈üarƒ± rengi */
            --button-bg: #4a90e2;
            --button-hover: #3a75c4;
            --progress-bg: #e9ecef;
            --progress-fill: var(--accent-color);
            --pomodoro-bg: #fff5e6;
            --pomodoro-accent: #ff6347; /* Domates kƒ±rmƒ±zƒ±sƒ± */
        }

        /* Koyu Tema */
        body[data-theme="dark"] {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --header-bg: #2d2d2d;
            --header-text: #ffffff;
            --text-color: #e0e0e0;
            --border-color: #333333;
            --day-bg: #252525;
            --accent-color: #90ee90; /* A√ßƒ±k ye≈üil */
            --button-bg: #555555;
            --button-hover: #666666;
            --progress-bg: #333333;
            --progress-fill: var(--accent-color);
            --pomodoro-bg: #382c2b;
            --pomodoro-accent: #ff7f50; /* Mercan */
        }

        /* Deniz Tema */
        body[data-theme="sea"] {
            --bg-color: #c4e3f1;
            --container-bg: #e0f2f7;
            --header-bg: #0077b6;
            --header-text: #ffffff;
            --text-color: #003049;
            --border-color: #b3cdd1;
            --day-bg: #f0f8fa;
            --accent-color: #00b4d8;
            --button-bg: #0077b6;
            --button-hover: #005f99;
            --progress-bg: #d0eaf1;
            --progress-fill: #00b4d8;
            --pomodoro-bg: #e6f7ff;
            --pomodoro-accent: #ff4d6d;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
            position: relative; /* Instagram linki i√ßin */
        }

        /* ======================================= */
        /* ANA D√úZEN VE BA≈ûLIK */
        /* ======================================= */

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--container-bg);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        header h1 {
            font-size: 1.8em;
            font-weight: 600;
        }
        
        /* ... Diƒüer CSS stilleri aynƒ± kalƒ±r ... */
        
        .timer-controls button {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
        }

        #start-btn {
            background-color: var(--pomodoro-accent);
            color: white;
        }

        #start-btn:hover {
            background-color: #e65133;
        }
        
        /* ... Diƒüer CSS stilleri aynƒ± kalƒ±r ... */

        /* ======================================= */
        /* INSTAGRAM LOGO VE Lƒ∞NK STƒ∞Lƒ∞ */
        /* ======================================= */
        .instagram-link {
            position: fixed;
            bottom: 20px;
            right: 20px; /* Saƒü alt k√∂≈üe */
            background-color: var(--container-bg);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s, background-color 0.2s;
            z-index: 1001; /* Her ≈üeyin √ºst√ºnde olmasƒ± i√ßin */
        }
        
        .instagram-link:hover {
            transform: translateY(-2px) scale(1.05);
            background-color: var(--day-bg);
        }

        .instagram-link i {
            color: #E1306C; /* Instagram'ƒ±n ana rengi */
            font-size: 1.5em;
        }

        /* Medya Sorgularƒ± */
        @media (max-width: 480px) {
            /* ... Diƒüer medya sorgularƒ± aynƒ± kalƒ±r ... */
            
            .instagram-link {
                right: 10px;
                bottom: 10px;
                padding: 8px 12px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>cosxomer ders √ßizelgesi</h1>
            <div class="header-controls">
                <select class="theme-select" onchange="setTheme(this.value)">
                    <option value="default">Varsayƒ±lan Tema</option>
                    <option value="dark">Koyu Tema</option>
                    <option value="sea">Deniz Tema</option>
                </select>
                <button class="pomodoro-btn" onclick="showPomodoroModal()">üçÖ Pomodoro Ba≈ülat</button>
            </div>
        </header>

        <div class="week-nav">
            <button class="nav-btn" onclick="changeWeek(-1)">‚¨Ö √ñnceki Hafta</button>
            <span id="week-info"></span>
            <button class="nav-btn" onclick="changeWeek(1)">Sonraki Hafta ‚û°</button>
            <span id="daily-score-display"></span>
        </div>

        <div id="schedule-container">
            <div class="schedule-grid">
                <div id="day-0" class="day-cell">
                    <h2>Pazartesi <span id="date-0"></span></h2>
                    <div id="score-0"></div>
                    <div class="cell-content-wrapper">
                        <ul class="task-list" data-day-index="0"></ul>
                        <div id="progress-0"></div>
                        <button class="add-task-btn" onclick="showAddTaskForm(0)">+ G√∂rev Ekle</button>
                    </div>
                </div>

                <div id="day-1" class="day-cell">
                    <h2>Salƒ± <span id="date-1"></span></h2>
                    <div id="score-1"></div>
                    <div class="cell-content-wrapper">
                        <ul class="task-list" data-day-index="1"></ul>
                        <div id="progress-1"></div>
                        <button class="add-task-btn" onclick="showAddTaskForm(1)">+ G√∂rev Ekle</button>
                    </div>
                </div>
                
                <div id="day-2" class="day-cell">
                    <h2>√áar≈üamba <span id="date-2"></span></h2>
                    <div id="score-2"></div>
                    <div class="cell-content-wrapper">
                        <ul class="task-list" data-day-index="2"></ul>
                        <div id="progress-2"></div>
                        <button class="add-task-btn" onclick="showAddTaskForm(2)">+ G√∂rev Ekle</button>
                    </div>
                </div>

                <div id="day-3" class="day-cell">
                    <h2>Per≈üembe <span id="date-3"></span></h2>
                    <div id="score-3"></div>
                    <div class="cell-content-wrapper">
                        <ul class="task-list" data-day-index="3"></ul>
                        <div id="progress-3"></div>
                        <button class="add-task-btn" onclick="showAddTaskForm(3)">+ G√∂rev Ekle</button>
                    </div>
                </div>

                <div id="day-4" class="day-cell">
                    <h2>Cuma <span id="date-4"></span></h2>
                    <div id="score-4"></div>
                    <div class="cell-content-wrapper">
                        <ul class="task-list" data-day-index="4"></ul>
                        <div id="progress-4"></div>
                        <button class="add-task-btn" onclick="showAddTaskForm(4)">+ G√∂rev Ekle</button>
                    </div>
                </div>

                <div id="day-5" class="day-cell">
                    <h2>Cumartesi <span id="date-5"></span></h2>
                    <div id="score-5"></div>
                    <div class="cell-content-wrapper">
                        <ul class="task-list" data-day-index="5"></ul>
                        <div id="progress-5"></div>
                        <button class="add-task-btn" onclick="showAddTaskForm(5)">+ G√∂rev Ekle</button>
                    </div>
                </div>

                <div id="day-6" class="day-cell">
                    <h2>Pazar <span id="date-6"></span></h2>
                    <div id="score-6"></div>
                    <div class="cell-content-wrapper">
                        <ul class="task-list" data-day-index="6"></ul>
                        <div id="progress-6"></div>
                        <button class="add-task-btn" onclick="showAddTaskForm(6)">+ G√∂rev Ekle</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="pomodoro-modal" class="modal-overlay">
        <div class="pomodoro-content">
            <button class="close-btn" onclick="hidePomodoroModal()">&times;</button>
            <h2 style="text-align: center;">üçÖ Pomodoro √áalƒ±≈üma Zamanlayƒ±cƒ±sƒ±</h2>

            <div class="time-inputs">
                <div>
                    <label for="study-hours">Saat:</label>
                    <input type="number" id="study-hours" value="0" min="0" max="10">
                </div>
                <div>
                    <label for="study-minutes">Dakika:</label>
                    <input type="number" id="study-minutes" value="25" min="1" max="59">
                </div>
            </div>

            <div id="timer-display" class="timer-display">00:25:00</div>
            <div id="timer-status" class="timer-status">Hazƒ±r.</div>

            <div class="timer-controls">
                <button id="start-btn" onclick="startTimer()">BA≈ûLAT</button>
                <button id="pause-btn" onclick="pauseTimer()">DURAKLAT</button>
                <button id="finish-btn" onclick="finishTimer(false)">KAYDET & Bƒ∞Tƒ∞R</button>
            </div>
            
            <div class="music-controls">
                <div id="music-title">üé∂ Fon M√ºziƒüi</div>
                <div class="music-buttons">
                    <button onclick="playMusic('rain', this)">üåßÔ∏è Yaƒümur Sesi</button>
                    <button onclick="playMusic('lofi', this)">‚òï Lofi Hip Hop</button>
                    <button onclick="playMusic('classic', this)">üéª Klasik M√ºzik</button>
                    <button onclick="stopMusic(this)">üö´ M√ºziƒüi Kapat</button>
                </div>
                
                <div class="volume-control">
                    <span>Ses Seviyesi:</span>
                    <input type="range" id="music-volume" min="0" max="100" step="5" oninput="setVolume(this.value)">
                    <span id="volume-display">15%</span>
                </div>
            </div>
        </div>
    </div>
    
    <a href="https://instagram.com/cosxomer" target="_blank" class="instagram-link">
        <i class="fab fa-instagram"></i>
        <span>/cosxomer</span>
    </a>


    <script>
        // JavaScript: Veri Kalƒ±cƒ±lƒ±ƒüƒ±, Tarih, TEMA ve M√úZƒ∞K Y√∂netimi
        
        const START_DATE_MS = new Date('2025-11-17T00:00:00').getTime();
        const END_DATE_MS = new Date('2026-06-20T00:00:00').getTime(); 
        const DAY_NAMES = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
        
        // üõë KRƒ∞Tƒ∞K: BURAYA MP3 VEYA OGG UZANTILI Dƒ∞REKT Lƒ∞NKLER Gƒ∞RMELƒ∞Sƒ∞Nƒ∞Z! 
        // Aksi takdirde m√ºzik √ßalmaz. (√ñrnek public domain ses linkleri kullanƒ±lmƒ±≈ütƒ±r)
        const MUSIC_SOURCES = {
            'rain': 'https://s3.eu-central-1.wasabisys.com/app-assets/free/rain.mp3', // √ñrnek Yaƒümur sesi
            'lofi': 'https://s3.eu-central-1.wasabisys.com/app-assets/free/lofi.mp3', // √ñrnek Lofi m√ºzik
            'classic': 'https://s3.eu-central-1.wasabisys.com/app-assets/free/classical.mp3' // √ñrnek Klasik M√ºzik
        };

        let currentOpenForm = null;
        let currentWeekOffset = 0;
        let draggedItem = null; 

        // Pomodoro Deƒüi≈ükenleri
        let timerInterval;
        let totalSeconds; 
        let initialSeconds = 25 * 60; 
        let isPaused = false;
        let expectedTime; 
        let remainingTimeOnPause = 25 * 60 * 1000; 

        // üõë HTML5 Audio Player Deƒüi≈ükeni
        let audioPlayer = null; 
        let currentTrackId = null; 
        let musicVolume = parseInt(localStorage.getItem('musicVolume') || '15'); // Sesi LocalStorage'dan y√ºkle
        
        // Bu kod artƒ±k YouTube API'sini beklemediƒüi i√ßin onYouTubeIframeAPIReady'e gerek kalmadƒ±.
        // Onun yerine DOMContentLoaded'da Audio objesini olu≈üturacaƒüƒ±z.

        document.addEventListener('DOMContentLoaded', () => {
            // Audio objesini ba≈ülat
            audioPlayer = new Audio();
            audioPlayer.loop = true;
            
            loadTheme();
            loadWeekFromURL();
            renderSchedule();
            
            updateTimerFromInputs(); 
            updateTimerDisplay();

            document.addEventListener('click', function(e) {
                if (currentOpenForm && !currentOpenForm.contains(e.target) && !e.target.classList.contains('add-task-btn') && !e.target.classList.contains('delete-btn') && !e.target.classList.contains('move-btn')) {
                    closeOpenForm();
                }
            });
            
            document.getElementById('study-hours').addEventListener('input', updateTimerFromInputsAndReset);
            document.getElementById('study-minutes').addEventListener('input', updateTimerFromInputsAndReset);
            
             // Ses √ßubuƒüunun ba≈ülangƒ±√ß deƒüerini LocalStorage'dan ayarla
            document.getElementById('music-volume').value = musicVolume;
            document.getElementById('volume-display').textContent = `${musicVolume}%`;
        });

        // =======================================
        // HTML5 AUDIO M√úZƒ∞K Y√ñNETƒ∞Mƒ∞
        // =======================================

        function playMusic(trackId, button) {
            
            // üõë TOGGLE MANTIƒûI: Aynƒ± par√ßa zaten √ßalƒ±yorsa, durdur
            if (currentTrackId === trackId) {
                stopMusic();
                return;
            }
            
            const audioSrc = MUSIC_SOURCES[trackId];
            const volume = parseInt(localStorage.getItem('musicVolume') || '15');

            // Kaynaƒüƒ± ayarla
            audioPlayer.src = audioSrc;
            
            // Ses seviyesini ayarla (HTML5 0.0 ile 1.0 arasƒ± kullanƒ±r)
            audioPlayer.volume = volume / 100;
            
            // Oynatma √ßaƒürƒ±sƒ± (Kullanƒ±cƒ± etkile≈üimi ile direkt ba≈ülatma)
            audioPlayer.play()
                .then(() => {
                    // Ba≈üarƒ±yla ba≈üladƒ±
                    currentTrackId = trackId; 
                    localStorage.setItem('currentTrackId', trackId);
                    updateMusicButtonStatus(button); 
                    document.getElementById('music-title').textContent = `üé∂ Fon M√ºziƒüi: ${button.textContent.replace(/[^\w\sƒü√º≈ü√∂√ßƒ∞ƒ±]/g, '')}`;
                })
                .catch(error => {
                    // Otomatik oynatma ba≈üarƒ±sƒ±z olursa (Nadiren bu linklerde olur)
                    console.error("Autoplay Failed:", error);
                    alert("M√ºzik ba≈ülatƒ±lamadƒ±. Tarayƒ±cƒ±nƒ±z ses kƒ±sƒ±tlamalarƒ±nƒ± uyguluyor olabilir.");
                    stopMusic();
                });
        }
        
        function stopMusic(button = null) {
            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer.currentTime = 0; // Ba≈üa sar
            }
            
            currentTrackId = null;
            
            // Aktif butonu kapat d√ºƒümesi ile i≈üaretle
            const stopBtn = document.querySelector('.music-buttons button[onclick*="stopMusic"]');
            updateMusicButtonStatus(stopBtn);
            
            localStorage.removeItem('currentTrackId');
            document.getElementById('music-title').textContent = `üé∂ Fon M√ºziƒüi`;
        }
        
        // Ses seviyesini HTML5 Audio Player ile ayarlar
        function setVolume(volume) {
            const volumeInt = parseInt(volume);
            
            // Audio player'ƒ±n ses seviyesini ayarla (0.0 - 1.0)
            if (audioPlayer) {
                audioPlayer.volume = volumeInt / 100;
            } 
            
            // Y√ºzde g√∂sterimini ve kaydƒ±rma √ßubuƒüunu g√ºncelle
            document.getElementById('music-volume').value = volumeInt;
            document.getElementById('volume-display').textContent = `${volumeInt}%`;
            
            // Sesi LocalStorage'a kaydet
            localStorage.setItem('musicVolume', volumeInt);
            musicVolume = volumeInt;
        }
        
        function updateMusicButtonStatus(activeButton) {
            const buttons = document.querySelectorAll('.music-buttons button');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (activeButton) {
                activeButton.classList.add('active');
            }
        }
        
        // ... (Geri kalan t√ºm fonksiyonlar (Tema, Pomodoro, √áizelge vb.) aynƒ± kalƒ±r)

        // =======================================
        // TEMA Y√ñNETƒ∞Mƒ∞ 
        // =======================================
        function setTheme(themeName) {
            document.body.setAttribute('data-theme', themeName);
            localStorage.setItem('selectedTheme', themeName);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            setTheme(savedTheme);
            document.querySelector('.theme-select').value = savedTheme; // Select'i senkronize et
        }

        // =======================================
        // POMODORO VE PUAN Y√ñNETƒ∞Mƒ∞ 
        // =======================================
        
        function getStudyScoreKey() {
            return `study_scores_week_${currentWeekOffset}`;
        }
        
        function loadStudyScores() {
            const key = getStudyScoreKey();
            const scoresJson = localStorage.getItem(key);
            return scoresJson ? JSON.parse(scoresJson) : [0, 0, 0, 0, 0, 0, 0];
        }
        
        function saveStudyScore(dayIndex, minutes) {
            const scores = loadStudyScores();
            scores[dayIndex] += minutes;
            const key = getStudyScoreKey();
            localStorage.setItem(key, JSON.stringify(scores));
            renderStudyScores();
        }
        
        function getCurrentDayIndex() {
            const today = new Date();
            return (today.getDay() + 6) % 7; 
        }

        function formatMinutesToHoursMinutes(totalMinutes) {
            if (totalMinutes < 60) {
                return `${totalMinutes} dk`;
            }
            const hours = Math.floor(totalMinutes / 60);
            const minutes = Math.round(totalMinutes % 60); 
            
            if (minutes === 0) {
                return `${hours} saat`;
            }
            return `${hours} saat ${minutes} dk`;
        }

        function renderStudyScores() {
            const scores = loadStudyScores();
            const currentDayIndex = getCurrentDayIndex(); 
            let dailyScoreToday = 0;

            for (let i = 0; i < 7; i++) {
                const scoreArea = document.getElementById(`score-${i}`);
                const scoreMinutes = scores[i]; 
                scoreArea.innerHTML = ''; 

                if (scoreMinutes > 0) {
                    const formattedScore = formatMinutesToHoursMinutes(scoreMinutes);
                    scoreArea.innerHTML = `<span class="study-score">‚úÖ ${formattedScore} √áalƒ±≈üƒ±ldƒ±</span>`;
                }
                
                if (currentWeekOffset === 0 && i === currentDayIndex) {
                    dailyScoreToday = scoreMinutes;
                }
            }
            
            const dailyScoreDisplay = document.getElementById('daily-score-display');
            if (currentWeekOffset === 0) {
                 const formattedDailyScore = formatMinutesToHoursMinutes(dailyScoreToday);
                 dailyScoreDisplay.textContent = `Bug√ºn: ${formattedDailyScore}`;
                 dailyScoreDisplay.style.display = 'inline-block';
            } else {
                 dailyScoreDisplay.style.display = 'none';
            }
        }
        
        // =======================================
        // POMODORO ZAMANLAYICI ƒ∞≈ûLEVLERƒ∞ 
        // =======================================

        function getInputValue(elementId) {
            const value = document.getElementById(elementId).value;
            return parseInt(value) || 0; 
        }

        function updateTimerFromInputs() {
            const hours = getInputValue('study-hours');
            const minutes = getInputValue('study-minutes');
            
            const newInitialSeconds = (hours * 3600) + (minutes * 60);
            initialSeconds = Math.max(0, newInitialSeconds);
        }

        function updateTimerFromInputsAndReset() {
            updateTimerFromInputs();
            resetTimer(true, false); 
        }


        function showPomodoroModal() {
            document.getElementById('pomodoro-modal').style.display = 'flex';
            document.getElementById('schedule-container').style.display = 'none';
            
            // Kayƒ±tlƒ± ses seviyesini y√ºkle ve g√∂ster
            const savedVolume = localStorage.getItem('musicVolume') || '15';
            document.getElementById('music-volume').value = savedVolume;
            document.getElementById('volume-display').textContent = `${savedVolume}%`;
            
            // Kayƒ±tlƒ± par√ßayƒ± aktif olarak i≈üaretle ve ba≈ülƒ±ƒüƒ± ayarla
            const savedTrackId = localStorage.getItem('currentTrackId');
            currentTrackId = savedTrackId;

            if (savedTrackId) {
                const activeBtn = document.querySelector(`.music-buttons button[onclick*="'${savedTrackId}'"]`);
                updateMusicButtonStatus(activeBtn);
                if(activeBtn) {
                     document.getElementById('music-title').textContent = `üé∂ Fon M√ºziƒüi: ${activeBtn.textContent.replace(/[^\w\sƒü√º≈ü√∂√ßƒ∞ƒ±]/g, '')}`; 
                }
            } else {
                 // Sadece M√ºzik Kapat butonu veya hi√ßbiri aktif olmalƒ±
                 updateMusicButtonStatus(document.querySelector('.music-buttons button[onclick*="stopMusic"]')); 
                 document.getElementById('music-title').textContent = `üé∂ Fon M√ºziƒüi`;
            }
            
            // Player objesi varsa, ses seviyesini senkronize et.
            if (audioPlayer) {
                 audioPlayer.volume = parseInt(savedVolume) / 100;
            }


            updateTimerFromInputs(); 
            resetTimer(true, false); 
        }

        function hidePomodoroModal() {
            document.getElementById('pomodoro-modal').style.display = 'none';
            document.getElementById('schedule-container').style.display = 'block';
            
            // Modal kapandƒ±ƒüƒ±nda m√ºziƒüi duraklatma, kullanƒ±cƒ± kontrol√ºnde bƒ±rakƒ±ldƒ±

            resetTimer(true, true); 
            renderSchedule(); 
        }

        function formatTime(totalSeconds) {
            totalSeconds = Math.max(0, totalSeconds || 0); 
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay() {
            let remainingMs;

            if (isPaused) {
                remainingMs = remainingTimeOnPause;
            } else if (timerInterval) {
                remainingMs = expectedTime - Date.now();
            } else {
                remainingMs = initialSeconds * 1000;
            }

            totalSeconds = remainingMs / 1000;
            
            document.getElementById('timer-display').textContent = formatTime(totalSeconds);
            
            if (totalSeconds <= 0 && !isPaused) {
                clearInterval(timerInterval);
                finishTimer(true); 
            }
        }

        function startTimer() {
            updateTimerFromInputs(); 
            
            if (initialSeconds <= 0) {
                 alert("√áalƒ±≈üma s√ºresi 1 dakikadan az olamaz.");
                 return;
            }

            if (timerInterval && !isPaused) return; 

            document.getElementById('study-hours').disabled = true; 
            document.getElementById('study-minutes').disabled = true; 

            document.getElementById('timer-status').textContent = "√áALI≈ûIYOR...";
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('pause-btn').style.display = 'inline-block';

            if (!timerInterval) {
                remainingTimeOnPause = initialSeconds * 1000; 
            }
            
            expectedTime = Date.now() + remainingTimeOnPause;

            isPaused = false;
            
            timerInterval = setInterval(updateTimerDisplay, 10); 
            
            updateTimerDisplay();
        }

        function pauseTimer() {
            if (!timerInterval || isPaused) return;

            clearInterval(timerInterval);
            timerInterval = null;
            isPaused = true;
            
            remainingTimeOnPause = expectedTime - Date.now();
            
            document.getElementById('timer-status').textContent = "DURAKLATILDI";
            document.getElementById('start-btn').style.display = 'inline-block';
            document.getElementById('pause-btn').style.display = 'none';
            
            updateTimerDisplay(); 
        }

        function finishTimer(isCompleted = false) {
            clearInterval(timerInterval);
            timerInterval = null;
            isPaused = false;
            
            const elapsedMs = (initialSeconds * 1000) - remainingTimeOnPause;
            const workedTimeSeconds = Math.max(0, elapsedMs / 1000);

            const workedMinutes = Math.round(workedTimeSeconds / 60); 
            
            if (workedMinutes > 0) {
                const dayIndex = getCurrentDayIndex();
                const dayName = DAY_NAMES[dayIndex];
                
                saveStudyScore(dayIndex, workedMinutes);
                
                const formattedScore = formatMinutesToHoursMinutes(workedMinutes);
                let message;
                if (isCompleted) {
                    message = `Tebrikler, √ñmer! ${formattedScore} Pomodoro ba≈üarƒ±yla tamamlandƒ± ve ${dayName} g√ºn√ºne puan olarak kaydedildi.`;
                } else {
                    message = `√ñmer, ${formattedScore} √ßalƒ±≈üma ${dayName} g√ºn√ºne puan olarak kaydedildi.`;
                }
                
                alert(message);
            } else if (!isCompleted) {
                 alert("√áok kƒ±sa √ßalƒ±≈ütƒ±nƒ±z, puan kaydedilmedi.");
            }
            
            resetTimer(true, false); 
            hidePomodoroModal(); 
        }

        function resetTimer(clearIntervalFlag = true, enableInputs = true) {
            if (clearIntervalFlag) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            isPaused = false;
            
            const hoursInput = document.getElementById('study-hours');
            const minutesInput = document.getElementById('study-minutes');

            if (enableInputs) {
                hoursInput.disabled = false;
                minutesInput.disabled = false;
                
                updateTimerFromInputs(); 
            }
            
            totalSeconds = initialSeconds;
            remainingTimeOnPause = initialSeconds * 1000; 
            
            document.getElementById('timer-display').textContent = formatTime(initialSeconds); 
            
            document.getElementById('timer-status').textContent = "Hazƒ±r.";
            document.getElementById('start-btn').style.display = 'inline-block';
            document.getElementById('pause-btn').style.display = 'none';
        }


        // =======================================
        // PROGRAM Y√ñNETƒ∞Mƒ∞ (Kalƒ±cƒ± Veri ve Tarih)
        // =======================================

        function getStorageKey(dayIndex) {
            return `tasks_week_${currentWeekOffset}_day_${dayIndex}`;
        }

        function getStorageKeyByOffset(weekOffset, dayIndex) {
            return `tasks_week_${weekOffset}_day_${dayIndex}`;
        }

        function loadTasks(dayIndex) {
            const key = getStorageKey(dayIndex);
            const tasksJson = localStorage.getItem(key);
            return tasksJson ? JSON.parse(tasksJson) : [];
        }

        function saveTasks(dayIndex, tasks) {
            const key = getStorageKey(dayIndex);
            localStorage.setItem(key, JSON.stringify(tasks));
            updateProgress(dayIndex);
        }
        
        function getWeekStartDate(offset) {
            const msPerWeek = 7 * 24 * 60 * 60 * 1000;
            return new Date(START_DATE_MS + (offset * msPerWeek));
        }

        function renderSchedule() {
            const weekStart = getWeekStartDate(currentWeekOffset);
            const weekEnd = new Date(weekStart.getTime() + 6 * 24 * 60 * 60 * 1000);
            
            const formatter = new Intl.DateTimeFormat('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
            
            document.getElementById('week-info').textContent = 
                `${formatter.format(weekStart)} - ${formatter.format(weekEnd)}`;

            const navButtons = document.querySelectorAll('.nav-btn');
            
            navButtons[1].disabled = weekStart.getTime() >= END_DATE_MS; 
            navButtons[0].disabled = currentWeekOffset <= 0 && weekStart.getTime() <= START_DATE_MS;

            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(weekStart.getTime() + i * 24 * 60 * 60 * 1000);
                const dayKey = `day-${i}`;
                const dateInfoElement = document.getElementById(`date-${i}`);
                const taskList = document.querySelector(`#${dayKey} .task-list`);
                const tasks = loadTasks(i);

                dateInfoElement.textContent = `${dayDate.getDate()} ${dayDate.toLocaleDateString('tr-TR', { month: 'short', year: 'numeric' })}`;
                
                taskList.innerHTML = ''; 

                tasks.forEach(task => {
                    createTaskElement(i, task.text, task.completed);
                });
                updateProgress(i);
                
                if (!taskList.hasAttribute('data-listeners-added')) {
                    taskList.addEventListener('dragover', handleDragOver);
                    taskList.addEventListener('drop', handleDrop);
                    taskList.setAttribute('data-listeners-added', 'true');
                }
            }
            renderStudyScores(); 
            updateURL();
        }
        
        // =======================================
        // DRAG AND DROP ƒ∞≈ûLEVLERƒ∞ 
        // =======================================

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function handleDragOver(e) {
            e.preventDefault(); 
            const currentList = e.currentTarget;
            
            if (!draggedItem) return; 

            const afterElement = getDragAfterElement(currentList, e.clientY);
            
            if (afterElement == null) {
                currentList.appendChild(draggedItem);
            } else {
                currentList.insertBefore(draggedItem, afterElement);
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            if (!draggedItem) return;

            const currentList = e.currentTarget;
            const currentDayIndex = parseInt(currentList.dataset.dayIndex);

            const reorderedTasks = [];
            const taskElements = currentList.querySelectorAll('.task-item');

            taskElements.forEach(item => {
                const taskText = item.querySelector('.task-text-content').textContent;
                const isCompleted = item.querySelector('.task-checkbox').checked;
                
                reorderedTasks.push({
                    text: taskText,
                    completed: isCompleted
                });
            });

            saveTasks(currentDayIndex, reorderedTasks);
            
            draggedItem.classList.remove('dragging');
            draggedItem.classList.add('is-squishing');
            
            setTimeout(() => {
                if (draggedItem) {
                    draggedItem.classList.remove('is-squishing');
                    draggedItem = null;
                }
            }, 200);
        }


        // =======================================
        // G√ñREV Y√ñNETƒ∞Mƒ∞ ƒ∞≈ûLEVLERƒ∞ 
        // =======================================
        
        function updateProgress(dayIndex) {
            const tasks = loadTasks(dayIndex);
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(task => task.completed).length;
            
            const progressWrapper = document.getElementById(`progress-${dayIndex}`);
            
            if (totalTasks === 0) {
                progressWrapper.innerHTML = `<div class="progress-text" style="display:block; text-align:center; color: var(--text-color); font-size: 0.9em;">G√∂rev yok.</div>`;
                return;
            }

            const percentage = Math.round((completedTasks / totalTasks) * 100);
            
            let progressBarContent = `${percentage}%`;
            const isCompleted = percentage === 100 ? 'completed-100' : '';

            if (percentage === 100) {
                progressBarContent = "TAMAMLANDI !!";
            } else if (percentage === 0) {
                progressBarContent = "0%";
            }
            
            const progressBarHTML = `
                <div class="progress-container">
                    <div class="progress-bar ${isCompleted}" style="width: ${percentage}%;">
                        ${progressBarContent}
                    </div>
                </div>
            `;
            
            progressWrapper.innerHTML = progressBarHTML;
        }

        function changeWeek(direction) {
            currentWeekOffset += direction;
            renderSchedule();
        }

        function updateURL() {
            const url = new URL(window.location);
            url.searchParams.set('week', currentWeekOffset);
            window.history.pushState({}, '', url);
        }

        function loadWeekFromURL() {
            const params = new URLSearchParams(window.location.search);
            const week = params.get('week');
            if (week !== null) {
                currentWeekOffset = parseInt(week) || 0;
            }
        }
        
        function moveTaskToNextDay(currentDayIndex, taskText) {
            deleteTaskFromStorage(currentDayIndex, taskText);

            let nextDayIndex = currentDayIndex + 1;
            let targetWeekOffset = currentWeekOffset;

            if (nextDayIndex > 6) {
                nextDayIndex = 0;
                targetWeekOffset += 1;
            }
            
            const nextDayKey = getStorageKeyByOffset(targetWeekOffset, nextDayIndex);

            let nextTasks = JSON.parse(localStorage.getItem(nextDayKey) || '[]');
            nextTasks.push({ text: taskText, completed: false });
            localStorage.setItem(nextDayKey, JSON.stringify(nextTasks));
            
            renderSchedule(); 
        }

        function closeOpenForm() {
            if (currentOpenForm) {
                const button = currentOpenForm.parentElement.querySelector('.add-task-btn');
                currentOpenForm.remove();
                button.style.display = 'block';
                currentOpenForm = null;
            }
        }
        
        function showAddTaskForm(dayIndex) {
            if (currentOpenForm) {
                closeOpenForm();
            }

            const dayCellWrapper = document.querySelector(`#day-${dayIndex} .cell-content-wrapper`);
            const button = dayCellWrapper.querySelector('.add-task-btn');
            
            if (dayCellWrapper.querySelector('.new-task-form')) {
                return;
            }

            const formDiv = document.createElement('div');
            formDiv.className = 'new-task-form';
            currentOpenForm = formDiv;

            const taskInput = document.createElement('input');
            taskInput.type = 'text';
            taskInput.placeholder = 'Yapƒ±lacak i≈üi yazƒ±n...';

            const addButton = document.createElement('button');
            addButton.textContent = 'Ekle';
            
            addButton.onclick = function() {
                const taskText = taskInput.value.trim();
                if (taskText) {
                    addTask(dayIndex, taskText);
                    closeOpenForm();
                }
            };

            formDiv.appendChild(taskInput);
            formDiv.appendChild(addButton);
            
            dayCellWrapper.insertBefore(formDiv, button);
            button.style.display = 'none';
            taskInput.focus();

            taskInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addButton.click();
                }
            });
        }
        
        function createTaskElement(dayIndex, text, completed = false) {
            const dayCellWrapper = document.querySelector(`#day-${dayIndex} .cell-content-wrapper`);
            const taskList = dayCellWrapper.querySelector('.task-list');
            
            const listItem = document.createElement('li');
            listItem.className = 'task-item' + (completed ? ' completed' : '');
            listItem.draggable = true; 

            listItem.addEventListener('dragstart', (e) => {
                draggedItem = listItem;
                e.dataTransfer.effectAllowed = 'move';
                
                listItem.classList.add('is-popping');
                setTimeout(() => listItem.classList.remove('is-popping'), 300); 

                setTimeout(() => listItem.classList.add('dragging'), 0);
            });
            listItem.addEventListener('dragend', () => {
                if (draggedItem && !draggedItem.classList.contains('is-squishing')) {
                     draggedItem.classList.remove('dragging');
                     draggedItem = null;
                }
            });


            const taskSpan = document.createElement('span');
            taskSpan.textContent = text;
            taskSpan.className = 'task-text-content';

            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'task-actions';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'task-checkbox';
            checkbox.checked = completed;

            checkbox.dataset.dayIndex = dayIndex;
            checkbox.dataset.taskText = text;

            checkbox.addEventListener('change', function() {
                this.parentElement.parentElement.classList.toggle('completed', this.checked);
                updateTaskCompletion(dayIndex, text, this.checked);
            });
            
            const moveButton = document.createElement('button');
            moveButton.textContent = '‚û°'; 
            moveButton.className = 'move-btn';
            
            moveButton.onclick = function() {
                if (listItem.classList.contains('completed')) {
                    alert("Tamamlanmƒ±≈ü g√∂revler ta≈üƒ±namaz.");
                    return;
                }
                moveTaskToNextDay(dayIndex, text);
            };

            const deleteButton = document.createElement('button');
            deleteButton.textContent = '‚úñ';
            deleteButton.className = 'delete-btn';
            
            deleteButton.onclick = function() {
                deleteTaskFromStorage(dayIndex, text);
                listItem.remove();
                updateProgress(dayIndex); 
            };

            actionsDiv.appendChild(checkbox);
            actionsDiv.appendChild(moveButton); 
            
            listItem.appendChild(actionsDiv);
            listItem.appendChild(taskSpan);
            listItem.appendChild(deleteButton);
            
            taskList.appendChild(listItem);
        }

        function addTask(dayIndex, text) {
            createTaskElement(dayIndex, text, false);

            const tasks = loadTasks(dayIndex);
            tasks.push({ text: text, completed: false });
            saveTasks(dayIndex, tasks);
        }

        function updateTaskCompletion(dayIndex, text, isCompleted) {
            const tasks = loadTasks(dayIndex);
            const taskIndex = tasks.findIndex(task => task.text === text);
            if (taskIndex > -1) {
                tasks[taskIndex].completed = isCompleted;
                saveTasks(dayIndex, tasks);
            }
        }

        function deleteTaskFromStorage(dayIndex, text) {
            let tasks = loadTasks(dayIndex);
            tasks = tasks.filter(task => task.text !== text);
            saveTasks(dayIndex, tasks);
        }
    </script>
</body>
</html>
