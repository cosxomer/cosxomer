<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSX Ã–MER DERS Ã‡Ä°ZELGESÄ° - LUXURY PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&family=Playfair+Display:ital,wght@1,700;1,900&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <style>
        /* ======================================= */
        /* TEMEL STÄ°LLER VE TEMA DEÄžÄ°ÅžKENLERÄ° */
        /* ======================================= */
        :root {
            /* VarsayÄ±lan Tema (LUXURY DARK MODE) */
            --bg-color: #0d0e14;
            --container-bg: #1e2029; 
            --header-bg: #14161c; 
            --header-text: #ffffff;
            --text-color: #c9d1d9; 
            --border-color: #383a47;
            --day-bg: #1e2029; 
            --accent-color: #bb86fc; 
            --accent-glow: rgba(187, 134, 252, 0.7);
            --button-bg: #30363d; 
            --button-hover: #40454c;
            --progress-bg: #30363d;
            --progress-fill: #bb86fc;
            --progress-complete: #fbc02d; 
            --pomodoro-bg: #14161c;
            --pomodoro-accent: #f87171; 
            --logo-content: "ODAK VE BAÅžARI YÃ–NETÄ°MÄ°";
            --logo-accent: #FFD700; 
            --task-bg: #272a33;
            --task-completed-bg: #383a47;
            --day-header-color: #e5e7eb;
            --task-text-color: #ffffff;
            --theme-icon-color: #c9d1d9;
            --day-border: 1px solid #383a47; 
            --instagram-bg: #30363d;
            --instagram-text: #c9d1d9;
            --theme-controls-bg: #272a33;
            --countdown-bg: #14161c;
            --countdown-fill: #00bcd4; 
            --countdown-text: #ffffff;
            --countdown-shadow: rgba(0, 188, 212, 0.8);
        }

        /* HELLO KITTY TEMASI */
        body[data-theme="kitty"] {
            --bg-color: #ffeef2;
            --container-bg: #ffffff;
            --header-bg: #f8a4b4; 
            --header-text: #8b0000; 
            --text-color: #4b0082; 
            --border-color: #ffc0cb; 
            --day-bg: #ffffff; 
            --accent-color: #ff1493; 
            --accent-glow: rgba(255, 20, 147, 0.7);
            --button-bg: #ff69b4; 
            --button-hover: #ff1493;
            --progress-bg: #ffe4e1; 
            --progress-fill: #ff1493; 
            --progress-complete: #ff69b4; 
            --pomodoro-bg: #ffffff;
            --pomodoro-accent: #dc143c; 
            --logo-content: "ðŸŽ€ SEVÄ°MLÄ° Ã‡ALIÅžMA ALANI ðŸŽ€";
            --logo-accent: #ff1493;
            --task-bg: #fff0f5; 
            --task-completed-bg: #fce7f3;
            --day-header-color: #8b0000;
            --task-text-color: #4b0082;
            --theme-icon-color: #ffffff;
            --day-border: 1px solid #ffc0cb; 
            --instagram-bg: #ff69b4;
            --instagram-text: #ffffff;
            --theme-controls-bg: #fbcfe2; 
            --countdown-bg: #ffe4e1;
            --countdown-fill: #4b0082; 
            --countdown-text: #8b0000;
            --countdown-shadow: rgba(75, 0, 130, 0.6);
        }
        
        /* SPIDERMAN - KORUMALI TEMA */
         body[data-theme="spiderman"] {
            --bg-color: #c0392b;
            --container-bg: #2c3e50; 
            --header-bg: #2c3e50; 
            --header-text: #ecf0f1; 
            --text-color: #ecf0f1; 
            --border-color: #34495e; 
            --day-bg: #34495e; 
            --accent-color: #f1c40f; 
            --accent-glow: rgba(241, 196, 15, 0.7);
            --button-bg: #e74c3c; 
            --button-hover: #c0392b; 
            --progress-bg: #3498db;
            --progress-fill: #f1c40f; 
            --progress-complete: #2ecc71;
            --pomodoro-bg: #2c3e50;
            --pomodoro-accent: #f1c40f; 
            --logo-content: "ðŸ•¸ï¸ MARVELOUS STUDY ðŸ•¸ï¸";
            --logo-accent: #ffffff; 
            --task-bg: #34495e;
            --task-completed-bg: #475569;
            --day-header-color: #ffffff;
            --task-text-color: #ecf0f1;
            --theme-icon-color: #ecf0f1;
            --day-border: 1px solid #475569; 
            --instagram-bg: #e74c3c;
            --instagram-text: #ffffff;
            --theme-controls-bg: #34495e; 
            --countdown-bg: #3498db;
            --countdown-fill: #3498db; 
            --countdown-text: #ffffff;
            --countdown-shadow: rgba(52, 152, 219, 0.8);
        }

        /* RESETLER */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
        }

        /* BUTON STÄ°LÄ° */
        button {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            background-color: var(--button-bg);
            color: var(--header-text);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transform: scale(1);
            /* **POMODORO BUTON DÃœZENLEMESÄ° BAÅžLANGIÃ‡** */
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px;
            /* **POMODORO BUTON DÃœZENLEMESÄ° BÄ°TÄ°Åž** */
        }
        
        button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* ======================================= */
        /* ZORUNLU GÄ°RÄ°Åž KAPISI STÄ°LÄ° */
        /* ======================================= */
        #login-gate {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s;
            padding: 20px;
        }

        .login-box {
            background-color: var(--container-bg);
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px var(--accent-glow); 
            width: 90%;
            max-width: 450px;
            text-align: center;
            border: 2px solid var(--accent-color);
            position: relative;
        }
        
        .login-box input {
            box-shadow: none;
            transition: border-color 0.3s;
            width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--task-bg); color: var(--text-color);
        }
        .login-box input:focus {
             outline: none;
             border-color: var(--accent-color) !important;
             box-shadow: 0 0 5px var(--accent-glow);
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .auth-tab {
            flex-grow: 1;
            padding: 15px 10px;
            cursor: pointer;
            font-weight: 700;
            color: var(--text-color);
            border-bottom: 3px solid transparent;
            transition: color 0.3s, border-bottom-color 0.3s;
        }
        
        .auth-tab.active {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
            text-shadow: 0 0 5px var(--accent-glow);
        }

        /* Instagram Butonu Stili - Login Box Ä°Ã§i */
        .login-box #instagram-follow-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background-color: #c13584; /* Instagram Rengi */
            color: white;
            padding: 12px;
            margin-top: 25px;
            font-weight: 700;
            border-radius: 8px;
            transition: opacity 0.2s;
            text-decoration: none;
        }
        .login-box #instagram-follow-btn:hover {
            opacity: 0.9;
        }


        /* ======================================= */
        /* DÄ°ÄžER STÄ°LLER KORUNDU */
        /* ======================================= */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: var(--container-bg);
            border-radius: 16px; 
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5); 
            overflow: hidden;
            position: relative;
        }
        
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; 
            gap: 20px;
            border-bottom: 2px solid var(--border-color);
        }
        
        header h1 {
            flex-shrink: 0;
            min-width: 300px;
            font-size: 2.5em;
            font-weight: 900; 
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--header-text);
            padding-top: 10px;
        }
        
        header h1::before {
             content: 'COSX Ã–MER';
             display: block;
             font-size: 2.3em; 
             font-weight: 900; 
             font-family: 'Playfair Display', serif; 
             font-style: italic; 
             margin-bottom: 5px;
             color: var(--logo-accent);
             text-shadow: 
                0 0 5px rgba(255, 215, 0, 0.5), 
                0 0 20px rgba(255, 215, 0, 0.8), 
                0 0 30px rgba(255, 215, 0, 0.5);
             letter-spacing: 3px; 
             line-height: 1;
        }

        header h1::after {
            content: var(--logo-content);
            display: block;
            font-size: 0.65em; 
            margin-top: 8px; 
            font-weight: 500; 
            letter-spacing: 3px; 
            color: var(--text-color); 
            opacity: 0.7;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap; 
            justify-content: flex-end;
        }
        
        .auth-section {
            flex-shrink: 0;
            display: flex; 
            align-items: center; 
            gap: 10px; 
            padding: 5px 10px; 
            border-radius: 8px; 
            background-color: var(--task-bg); 
            border: 1px solid var(--border-color);
        }

        /* KullanÄ±cÄ± gÃ¶rseli kaldÄ±rÄ±ldÄ±, sadece ad ve Ã§Ä±kÄ±ÅŸ butonu kaldÄ± */
        #user-info {
            display: flex;
            align-items: center; 
            gap: 10px;
        }

        .header-stats {
             display: flex;
             gap: 15px;
             flex-wrap: wrap; 
        }

        .header-stats > span {
            white-space: nowrap;
            flex-shrink: 0;
            font-size: 1.1em;
            font-weight: 700;
            padding: 8px 15px;
            border-radius: 8px;
            background-color: var(--task-bg);
            box-shadow: 0 0 8px var(--accent-glow);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
        }

        #today-worked-time {
            border: 1px solid var(--pomodoro-accent);
            color: var(--pomodoro-accent);
            box-shadow: 0 0 8px rgba(248, 113, 113, 0.5);
        }
        
        .theme-controls {
             display: flex;
             gap: 8px;
             padding: 5px;
             border-radius: 12px;
             background-color: var(--theme-controls-bg); 
             border: 1px solid var(--border-color);
        }
        
        .theme-button {
             background: none;
             padding: 8px;
             border-radius: 8px;
             font-size: 1.2em;
             color: var(--theme-icon-color);
             box-shadow: none;
             transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
        }
        
        .theme-button:hover {
            background-color: var(--button-hover);
        }
        
        .theme-button.active {
            background-color: var(--accent-color);
            color: var(--header-text);
            box-shadow: 0 0 10px var(--accent-glow);
            border: 1px solid var(--header-text);
        }

        #instagram-link {
            background-color: var(--instagram-bg);
            color: var(--instagram-text);
            font-size: 1em;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: color 0.3s, box-shadow 0.3s, background-color 0.3s;
            font-weight: 600;
        }
        
        #instagram-link:hover {
            color: var(--accent-color);
            border-color: var(--accent-color);
            box-shadow: 0 0 10px var(--accent-glow);
        }


        .main-content {
            display: flex;
            padding: 0 40px 40px 40px; 
            gap: 30px; 
        }

        #schedule-container {
            flex-grow: 1;
            min-width: 100%; 
        }
        
        #yks-countdown-container {
            width: 100%;
            padding: 20px 40px; 
            background-color: var(--header-bg); 
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: center; 
            align-items: center;
            gap: 30px;
        }
        
        #yks-countdown-container h2 {
            font-size: 1.2em;
            font-weight: 900;
            color: var(--logo-accent);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
            padding-right: 30px;
            border-right: 1px solid var(--border-color);
            line-height: 1.2;
            text-align: right;
            min-width: 150px;
        }
        
        .countdown-group {
             display: flex;
             gap: 20px;
             align-items: center;
             flex-grow: 1; 
             justify-content: center;
        }

        .countdown-item {
            width: 80px;
            height: 80px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; 
            border-radius: 50%;
        }
        
        .countdown-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        
        .countdown-circle-bg {
            fill: none;
            stroke: var(--countdown-bg);
            stroke-width: 6; 
        }
        
        .countdown-circle-fill {
            fill: none;
            stroke: var(--countdown-fill);
            stroke-width: 5; 
            stroke-linecap: round; 
            transition: stroke-dashoffset 0.9s linear; 
            filter: drop-shadow(0 0 3px var(--countdown-shadow));
        }
        
        .countdown-value {
            position: absolute;
            text-align: center;
            color: var(--countdown-text);
        }
        
        .countdown-value strong {
            display: block;
            font-size: 2.0em; 
            font-weight: 900;
            line-height: 1;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        .countdown-value span {
            display: block;
            font-size: 0.65em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 3px;
            color: var(--text-color);
        }
        
        #yks-target-date {
            font-size: 0.8em;
            padding-left: 30px;
            border-left: 1px solid var(--border-color);
            white-space: nowrap;
            color: var(--text-color);
        }

        .task-item {
             position: relative;
             display: flex;
             flex-direction: column; 
             align-items: flex-start; 
             cursor: move; 
             padding: 10px 15px; 
             margin-bottom: 8px;
             background-color: var(--task-bg);
             border-radius: 6px;
             border-left: 5px solid transparent; 
             transition: all 0.2s ease;
             line-height: 1.3;
        }
        
        .task-item:hover {
            border-left-color: var(--accent-color);
            box-shadow: 0 0 5px var(--accent-glow);
        }
        .task-item.dragging {
            opacity: 0.5;
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            cursor: grabbing;
        }
        
        .task-content-wrapper {
             width: 100%;
             display: flex;
             align-items: flex-start; 
             justify-content: space-between;
        }
        
        .task-item.completed {
            border-left-color: var(--progress-complete);
            opacity: 0.85;
            box-shadow: 0 0 10px rgba(251, 192, 45, 0.7); 
            cursor: move;
        }
        
        .task-item.completed .task-text-content:after {
            content: " [Bitti]";
            color: var(--progress-complete);
            font-size: 0.8em; 
            font-weight: 700;
            margin-left: 5px;
            text-shadow: 0 0 3px var(--progress-complete);
        }
        
        .day-progress-area {
            margin: 10px 0 15px 0;
            text-align: center;
            position: relative;
        }

        .day-progress-container {
            width: 100%;
            height: 12px;
            background-color: var(--progress-bg);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .day-progress-fill {
            height: 100%;
            background-color: var(--progress-fill);
            transition: width 0.5s ease-in-out, background-color 0.5s;
            position: relative;
        }
        
        .day-progress-fill.complete {
             background-color: var(--progress-complete);
             box-shadow: 0 0 15px var(--progress-complete);
             filter: brightness(1.2);
        }
        
        .day-progress-percentage {
            position: absolute;
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 0.9em;
            font-weight: 800; 
            color: var(--header-text);
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5); 
            z-index: 5;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9); 
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .pomodoro-content {
            background-color: var(--pomodoro-bg);
            padding: 50px; 
            border-radius: 16px; 
            box-shadow: 0 0 50px var(--accent-glow); 
            max-width: 600px; 
            width: 90%; 
            text-align: center; 
            position: relative;
            border: 2px solid var(--accent-color);
        }

        #finish-btn {
            background-color: var(--pomodoro-accent);
            color: var(--header-text);
            box-shadow: 0 0 10px rgba(248, 113, 113, 0.7);
            font-weight: 700;
        }

        #finish-btn:hover {
            background-color: #ef4444;
        }
        
        .timer-display {
            font-size: 6em;
            font-weight: 900; 
            color: var(--pomodoro-accent); 
            letter-spacing: 2px; 
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(248, 113, 113, 0.7);
        }
        
        .timer-controls {
            display: flex;
            justify-content: center; 
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .timer-controls button {
             padding: 12px 25px;
             font-size: 1.1em;
             min-width: 120px;
             /* Ä°kon ve Metin Ã§akÄ±ÅŸmasÄ±nÄ± engellemek iÃ§in */
             gap: 8px;
        }
        
        .timer-controls > div { 
            position: relative;
            width: 140px; 
            height: 50px; 
        }
        
        .timer-controls > div button {
            position: absolute;
            width: 100%; 
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px; /* Ä°kon ve Metin Ã§akÄ±ÅŸmasÄ±nÄ± engellemek iÃ§in */
        }
        
        /* Pomodoro SÃ¼re Ayarlama AlanÄ± DÃ¼zeltmeleri */
        .pomodoro-time-inputs {
            display: flex; 
            justify-content: center; 
            gap: 15px; 
            margin-bottom: 20px;
        }
        .pomodoro-time-inputs input {
             width: 60px; 
             text-align: center; 
             padding: 8px;
             border: 1px solid var(--border-color); 
             border-radius: 6px;
             background-color: var(--task-bg); 
             color: var(--text-color);
             transition: border-color 0.2s;
        }
        .pomodoro-time-inputs input:focus {
             outline: none;
             border-color: var(--accent-color);
        }

        /* GÃ¶rev SÃ¼tunlarÄ±nÄ±n GeniÅŸletilmesi (DeÄŸiÅŸiklik burada yapÄ±ldÄ±) */
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(250px, 1fr)); /* Min geniÅŸlik 250px'e Ã§Ä±karÄ±ldÄ± */
            border-top: 1px solid var(--border-color); 
            overflow-x: auto; 
            min-width: 100%;
        }
        
        .day-cell {
             padding: 20px 15px;
             border-right: var(--day-border); 
             background-color: var(--day-bg); 
             min-height: 550px; 
             display: flex; 
             flex-direction: column;
        }
        
        .schedule-grid > .day-cell:last-child {
            border-right: none;
        }
        
        .cell-content-wrapper {
             flex-grow: 1;
             display: flex; 
             flex-direction: column;
        }
        
        .add-task-btn {
            margin-top: auto;
        }

        /* Responsive Query'ler Korundu */

        @media (max-width: 1200px) {
            header {
                padding: 20px 30px;
                justify-content: center;
                text-align: center;
            }
            .header-controls {
                 justify-content: center;
                 gap: 10px;
                 width: 100%; 
                 margin-top: 15px;
            }
            .header-stats, .theme-controls {
                margin-top: 10px;
            }
            .pomodoro-btn {
                order: -1;
                width: 100%;
                margin-bottom: 10px;
            }
            .auth-section {
                 order: -2;
                 width: 100%;
                 justify-content: center;
            }
            #yks-countdown-container {
                 flex-direction: column;
                 padding: 20px 30px;
            }
            #yks-countdown-container h2 {
                 text-align: center;
                 border-right: none;
                 padding-right: 0;
                 margin-bottom: 15px;
                 min-width: auto;
            }
            #yks-target-date {
                 border-left: none;
                 padding-left: 0;
            }
            .countdown-group {
                gap: 15px;
                max-width: 300px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .container {
                border-radius: 8px;
            }
            header {
                padding: 15px 20px;
            }
            .main-content {
                padding: 0 10px 10px 10px;
            }
            header h1 {
                font-size: 1.8em;
                min-width: 100%;
            }
            header h1::before {
                 font-size: 1.5em;
            }
            header h1::after {
                 font-size: 0.5em;
            }
            .header-stats > span {
                font-size: 0.9em;
                padding: 6px 12px;
            }
            .week-nav {
                padding: 10px 15px;
            }
            .week-nav h3 {
                font-size: 1.2em;
            }
            .day-cell {
                padding: 10px 8px;
                min-height: 400px;
            }
            .schedule-grid {
                 grid-template-columns: repeat(7, minmax(100px, 1fr)); 
            }
            #yks-countdown-container {
                 padding: 15px 20px;
            }
            .countdown-item {
                 width: 60px;
                 height: 60px;
            }
            .countdown-value strong {
                 font-size: 1.5em;
            }
            .countdown-value span {
                 font-size: 0.5em;
            }
            .pomodoro-content {
                 padding: 30px;
            }
            .timer-display {
                 font-size: 4em;
            }
            .timer-controls {
                 flex-direction: column;
            }
            .timer-controls button {
                 width: 100%;
                 margin-bottom: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .header-stats {
                flex-direction: column;
                align-items: stretch;
            }
            .header-stats > span {
                width: 100%;
                text-align: center;
            }
        }
        
        /* Ã–ZEL UYARI KUTUSU STÄ°LÄ° */
        #custom-alert {
            position: fixed;
            top: -50px;
            right: 20px;
            padding: 10px 20px;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.5s, top 0.5s;
        }
        
        /* EKLENEN HTML ELEMENTLERÄ° Ä°Ã‡Ä°N STÄ°LLER */
        .day-header {
             font-size: 1.3em; 
             font-weight: 800;
             color: var(--day-header-color);
             margin-bottom: 5px; /* AltÄ±ndaki sÃ¼re iÃ§in boÅŸluk azaltÄ±ldÄ± */
             text-align: center;
             padding-bottom: 5px;
             border-bottom: 2px solid var(--border-color);
        }

        .day-score-display {
             display: block;
             font-size: 0.85em;
             font-weight: 600;
             color: var(--pomodoro-accent); 
             text-shadow: 0 0 5px rgba(248, 113, 113, 0.3);
             margin-bottom: 10px; 
             text-align: center;
        }
        
        .task-list {
             list-style: none;
             padding: 0;
             margin: 0;
             flex-grow: 1; 
             min-height: 10px; 
        }
        
        .task-text-content {
             flex-grow: 1; 
             font-weight: 600;
             color: var(--task-text-color);
             display: block;
        }

    </style>
</head>
<body>
    <div id="custom-alert" style="background-color: #ef4444;">Hata MesajÄ±</div>

    <div id="login-gate">
        <div class="login-box">
            <h2 style="color: var(--accent-color); font-size: 2em; margin-bottom: 10px;">COSX Ã–MER</h2>
            <p style="color: var(--text-color); margin-bottom: 20px; font-size: 1.1em; opacity: 0.8;">Ã‡alÄ±ÅŸma AlanÄ±na EriÅŸim</p>
            
            <div class="auth-tabs">
                <div class="auth-tab active" id="login-tab" onclick="showAuthForm('login')">GÄ°RÄ°Åž YAP</div>
                <div class="auth-tab" id="signup-tab" onclick="showAuthForm('signup')">KAYIT OL</div>
            </div>
            
            <div id="login-form">
                <input type="email" id="login-email" placeholder="E-posta Adresi" required>
                <input type="password" id="login-password" placeholder="Åžifre" required onkeydown="if(event.key === 'Enter') signInWithEmailPassword()">
                <button onclick="signInWithEmailPassword()" style="width: 100%; background-color: var(--accent-color); font-size: 1.1em; padding: 12px; font-weight: 700;">
                    <i class="fas fa-sign-in-alt"></i> GÄ°RÄ°Åž YAP
                </button>
            </div>
            
            <div id="signup-form" style="display: none;">
                <input type="text" id="signup-username" placeholder="KullanÄ±cÄ± AdÄ±" required>
                <input type="email" id="signup-email" placeholder="E-posta Adresi" required>
                <input type="password" id="signup-password" placeholder="Åžifre (Min. 6 Karakter)" required onkeydown="if(event.key === 'Enter') signUpWithEmailPasswordAndUsername()">
                <button onclick="signUpWithEmailPasswordAndUsername()" style="width: 100%; background-color: var(--pomodoro-accent); font-size: 1.1em; padding: 12px; font-weight: 700;">
                    <i class="fas fa-user-plus"></i> KAYIT OL
                </button>
            </div>
            
            <p id="login-error-message" style="color: #ef4444; margin-top: 15px; font-weight: 600;"></p>
            
            <a id="instagram-follow-btn" href="https://instagram.com/cosxomer" target="_blank">
                <i class="fab fa-instagram"></i> Instagram'dan Takip Et /cosxomer
            </a>
            <p style="color: var(--text-color); margin-top: 15px; font-size: 0.8em; opacity: 0.6;">Bu platformu kullanmak iÃ§in giriÅŸ yapmalÄ±sÄ±nÄ±z.</p>
        </div>
    </div>
    
    <div class="container">
        
        <header>
            <h1></h1>
            <div class="header-controls">
                
                <div class="auth-section" id="user-info" style="display: none;">
                    <span id="username-display" style="font-weight: 700; color: var(--accent-color);"></span>
                    <button id="logout-btn" onclick="signOutUser()" style="background-color: var(--pomodoro-accent); color: var(--header-text); padding: 5px 10px; font-size: 0.9em;"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ Yap</button>
                </div>
                
                <div class="header-stats">
                    <span id="all-time-score"><i class="fas fa-trophy"></i> Toplam: 0s</span>
                    <span id="today-worked-time"><i class="fas fa-clock"></i> BugÃ¼n: 0s</span>
                </div>

                <div class="theme-controls">
                    <button class="theme-button" data-theme="luxury" onclick="setTheme('luxury')"><i class="fas fa-moon"></i></button>
                    <button class="theme-button" data-theme="kitty" onclick="setTheme('kitty')"><i class="fas fa-cat"></i></button>
                    <button class="theme-button" data-theme="spiderman" onclick="setTheme('spiderman')"><i class="fas fa-spider"></i></button>
                </div>
                
                <button id="pomodoro-btn" onclick="showPomodoroModal()" class="pomodoro-btn" style="background-color: var(--pomodoro-accent);"><i class="fas fa-hourglass-half"></i> ODAK ZAMANI</button>
                
                <a id="instagram-link" href="https://instagram.com/cosxomer" target="_blank">
                     <i class="fab fa-instagram"></i> /cosxomer
                </a>
            </div>
        </header>

        <div id="yks-countdown-container">
            <h2>YKS 2026<br>Geri SayÄ±m</h2>
            <div class="countdown-group">
                
                <div class="countdown-item">
                    <svg class="countdown-svg" viewBox="0 0 40 40">
                        <circle class="countdown-circle-bg" cx="20" cy="20" r="18"></circle>
                        <circle class="countdown-circle-fill" cx="20" cy="20" r="18" id="weeks-circle"></circle>
                    </svg>
                    <div class="countdown-value">
                        <strong id="weeks-value">00</strong>
                        <span>Hafta</span>
                    </div>
                </div>
                
                <div class="countdown-item">
                    <svg class="countdown-svg" viewBox="0 0 40 40">
                        <circle class="countdown-circle-bg" cx="20" cy="20" r="18"></circle>
                        <circle class="countdown-circle-fill" cx="20" cy="20" r="18" id="days-circle"></circle>
                    </svg>
                    <div class="countdown-value">
                        <strong id="days-value">00</strong>
                        <span>GÃ¼n</span>
                    </div>
                </div>
                
                <div class="countdown-item">
                    <svg class="countdown-svg" viewBox="0 0 40 40">
                        <circle class="countdown-circle-bg" cx="20" cy="20" r="18"></circle>
                        <circle class="countdown-circle-fill" cx="20" cy="20" r="18" id="hours-circle"></circle>
                    </svg>
                    <div class="countdown-value">
                        <strong id="hours-value">00</strong>
                        <span>Saat</span>
                    </div>
                </div>
                <div class="countdown-item">
                    <svg class="countdown-svg" viewBox="0 0 40 40">
                        <circle class="countdown-circle-bg" cx="20" cy="20" r="18"></circle>
                        <circle class="countdown-circle-fill" cx="20" cy="20" r="18" id="minutes-circle"></circle>
                    </svg>
                    <div class="countdown-value">
                        <strong id="minutes-value">00</strong>
                        <span>Dakika</span>
                    </div>
                </div>
                <div class="countdown-item">
                    <svg class="countdown-svg" viewBox="0 0 40 40">
                        <circle class="countdown-circle-bg" cx="20" cy="20" r="18"></circle>
                        <circle class="countdown-circle-fill" cx="20" cy="20" r="18" id="seconds-circle"></circle>
                    </svg>
                    <div class="countdown-value">
                        <strong id="seconds-value">00</strong>
                        <span>Saniye</span>
                    </div>
                </div>
            </div>
            <p id="yks-target-date">21 Haziran 2026 @ 10:00</p>
        </div>

        <div class="week-nav" style="padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; background-color: var(--container-bg); border-bottom: 1px solid var(--border-color);">
             <button onclick="changeWeek(-1)" style="background-color: var(--accent-color); color: var(--header-text);"><i class="fas fa-chevron-left"></i> Ã–nceki Hafta</button>
             <h3 id="week-display" style="font-size: 1.5em; color: var(--header-text);">Mevcut Hafta</h3>
             <button onclick="changeWeek(1)" style="background-color: var(--accent-color); color: var(--header-text);">Sonraki Hafta <i class="fas fa-chevron-right"></i></button>
        </div>

        <div class="main-content">
            <div id="schedule-container">
                <div class="schedule-grid">
                    </div>
            </div>
        </div>
    </div>

    <div id="pomodoro-modal" class="modal-overlay">
        <div class="pomodoro-content">
            <button id="close-pomodoro-btn" onclick="hidePomodoroModal()" style="position: absolute; top: 15px; right: 15px; background: none; color: var(--text-color); font-size: 1.5em; box-shadow: none;"><i class="fas fa-times"></i></button>
            <h3 id="timer-status" style="color: var(--accent-color); margin-bottom: 15px; font-size: 1.5em;">Odak ZamanlayÄ±cÄ±sÄ±</h3>
            
            <div class="pomodoro-time-inputs">
                <input type="number" id="study-hours" value="0" min="0" max="24" placeholder="Saat">
                <input type="number" id="study-minutes" value="25" min="0" max="59" placeholder="Dakika">
                <input type="number" id="study-seconds" value="0" min="0" max="59" placeholder="Saniye">
            </div>

            <div id="timer-display" class="timer-display">00:25:00</div>
            
            <p id="pomodoro-status" style="color: var(--pomodoro-accent); font-weight: 700; margin-top: 5px;">HazÄ±r.</p>
            
            <div class="timer-controls">
                <div id="start-pause-container">
                    <button id="start-btn" onclick="startTimer()" style="background-color: var(--accent-color); font-weight: 700; color: var(--header-text);"><i class="fas fa-play"></i> BAÅžLAT</button>
                    <button id="pause-btn" onclick="pauseTimer()" style="display: none; background-color: var(--accent-color); font-weight: 700; color: var(--header-text); opacity: 0;"><i class="fas fa-pause"></i> DURAKLAT</button>
                </div>
                <button id="reset-btn" onclick="resetTimer(true)" style="background-color: var(--button-bg);"><i class="fas fa-undo"></i> SIFIRLA</button>
                <button id="finish-btn" onclick="finishTimer(false)"><i class="fas fa-stop"></i> BÄ°TÄ°R & KAYDET</button>
            </div>
        </div>
    </div>
    
    <audio id="audio-player" src="bell.mp3" preload="auto"></audio>
    
    <script>
        
        // =======================================
        // FIREBASE CONFIG - KESÄ°NLEÅžTÄ°RÄ°LMÄ°Åž
        // =======================================
        const firebaseConfig = {
            // ANAHTARLARINIZ
            apiKey: "AIzaSyAzNCtpGZdh4N2UtD-ZUp_KHS_US452COE",
            authDomain: "cosxomer-7fdec.firebaseapp.com",
            projectId: "cosxomer-7fdec",
            storageBucket: "cosxomer-7fdec.firebasestorage.app",
            messagingSenderId: "853886482736",
            appId: "1:853886482736:web:416abcaa2e3b92546830f5" // SON SATIRDA VÄ°RGÃœL YOK
        };

        let auth;
        let currentUser = null;
        const fallbackUserName = 'Ã–mer'; // VarsayÄ±lan kullanÄ±cÄ± adÄ±

        // =======================================
        // TEMA YÃ–NETÄ°MÄ° FONKSÄ°YONLARI
        // =======================================
        function setTheme(themeName) {
            document.body.setAttribute('data-theme', themeName);
            localStorage.setItem('theme', themeName);
            
            const themeButtons = document.querySelectorAll('.theme-button');
            if (themeButtons.length > 0) {
                themeButtons.forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const activeBtn = document.querySelector(`.theme-button[data-theme="${themeName}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'luxury'; 
            setTheme(savedTheme);
        }

        // =======================================
        // FIREBASE AUTH FONKSÄ°YONLARI
        // =======================================
        function initFirebaseAuth() {
            if (!window.firebase.apps.length) {
                window.firebase.initializeApp(firebaseConfig);
            }
            auth = window.firebase.auth();
            auth.onAuthStateChanged(handleAuthStateChange);
        }
        
        function showAuthForm(formType) {
            document.getElementById('login-form').style.display = formType === 'login' ? 'block' : 'none';
            document.getElementById('signup-form').style.display = formType === 'signup' ? 'block' : 'none';
            document.getElementById('login-tab').classList.toggle('active', formType === 'login');
            document.getElementById('signup-tab').classList.toggle('active', formType === 'signup');
            document.getElementById('login-error-message').textContent = '';
        }

        function getAuthErrorMessage(errorCode) {
            switch(errorCode) {
                case 'auth/wrong-password': return "HatalÄ± ÅŸifre.";
                case 'auth/user-not-found': return "BÃ¶yle bir kullanÄ±cÄ± bulunamadÄ±.";
                case 'auth/email-already-in-use': return "Bu e-posta adresi zaten kullanÄ±mda.";
                case 'auth/invalid-email': return "GeÃ§ersiz e-posta formatÄ±.";
                case 'auth/weak-password': return "Åžifre en az 6 karakter olmalÄ±dÄ±r.";
                case 'auth/network-request-failed': return "AÄŸ baÄŸlantÄ± hatasÄ±. Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin.";
                default: return "GiriÅŸ/KayÄ±t hatasÄ±. LÃ¼tfen bilgilerinizi kontrol edin.";
            }
        }

        function signInWithEmailPassword() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorMessage = document.getElementById('login-error-message');
            errorMessage.textContent = '';

            if (!email || !password) {
                errorMessage.textContent = 'LÃ¼tfen e-posta ve ÅŸifrenizi giriniz.';
                return;
            }

            if (auth && auth.signInWithEmailAndPassword) {
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        errorMessage.textContent = '';
                        showCustomAlert("GiriÅŸ baÅŸarÄ±lÄ±! HoÅŸ geldin, " + (auth.currentUser.displayName || fallbackUserName), '#22c55e');
                    })
                    .catch((error) => {
                        errorMessage.textContent = getAuthErrorMessage(error.code);
                    });
            } else {
                errorMessage.textContent = 'Hata: Kimlik doÄŸrulama servisi kullanÄ±lamÄ±yor.';
            }
        }

        function signUpWithEmailPasswordAndUsername() {
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const errorMessage = document.getElementById('login-error-message');
            errorMessage.textContent = '';

            if (!username || !email || !password) {
                errorMessage.textContent = 'LÃ¼tfen tÃ¼m alanlarÄ± doldurunuz.';
                return;
            }

            if (auth && auth.createUserWithEmailAndPassword) {
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // KullanÄ±cÄ± adÄ±nÄ± Firebase'e kaydet
                        return userCredential.user.updateProfile({
                            displayName: username,
                            photoURL: "placeholder.png"
                        });
                    })
                    .then(() => {
                        errorMessage.textContent = '';
                        showCustomAlert("KayÄ±t baÅŸarÄ±lÄ±! HoÅŸ geldin, " + username, '#22c55e');
                    })
                    .catch((error) => {
                        errorMessage.textContent = getAuthErrorMessage(error.code);
                    });
            } else {
                errorMessage.textContent = 'Hata: Kimlik doÄŸrulama servisi kullanÄ±lamÄ±yor.';
            }
        }

        function handleAuthStateChange(user) {
            const loginGate = document.getElementById('login-gate');
            currentUser = user; 
            
            if (currentUser) {
                loginGate.style.opacity = '0';
                setTimeout(() => { loginGate.style.display = 'none'; }, 300);
                document.getElementById('logout-btn').style.display = 'flex';
                updateUserInfo(currentUser);
                renderSchedule();
                updateAllDayScoresAndToday();
            } else {
                loginGate.style.opacity = '1';
                loginGate.style.display = 'flex';
                document.getElementById('logout-btn').style.display = 'none';
                document.getElementById('user-info').style.display = 'none';
            }
        }

        function updateUserInfo(currentUser) {
            const userInfo = document.getElementById('user-info');
            const usernameDisplay = document.getElementById('username-display');
            
            if (currentUser) {
                userInfo.style.display = 'flex';
                usernameDisplay.textContent = currentUser.displayName || fallbackUserName; 
            } else {
                userInfo.style.display = 'none';
            }
        }

        function signOutUser() {
            if (!auth) return;
            auth.signOut().then(() => {
                showCustomAlert("BaÅŸarÄ±yla Ã§Ä±kÄ±ÅŸ yapÄ±ldÄ±.", '#0ea5e9');
            }).catch(error => {
                console.error("Ã‡Ä±kÄ±ÅŸ hatasÄ±:", error);
            });
        }
        
        // =======================================
        // SABÄ°T DEÄžÄ°ÅžKENLER
        // =======================================
        const DAY_NAMES = ['Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi', 'Pazar'];
        const YKS_CIRCUMFERENCE = 2 * Math.PI * 18;
        let currentWeekOffset = 0;
        let draggedItem = null;
        let openFormDayIndex = null;
        
        // =======================================
        // YKS GERÄ° SAYIM (21 Haziran 2026 @ 10:00)
        // =======================================
        const YKS_TARGET_DATE_MS = new Date(2026, 5, 21, 10, 0, 0).getTime();
        let yksInterval;
        
        function updateCountdown() {
            const now = new Date().getTime();
            let distance = YKS_TARGET_DATE_MS - now;
            
            if (distance < 0) {
                distance = 0;
                clearInterval(yksInterval);
            }

            const totalDays = Math.floor(distance / (1000 * 60 * 60 * 24));
            const totalWeeks = Math.floor(totalDays / 7);
            const daysLeft = totalDays % 7;
            const hoursLeft = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutesLeft = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const secondsLeft = Math.floor((distance % (1000 * 60)) / 1000);

            // DeÄŸerleri HTML'e yazma
            // YKS sayacÄ±nda gÃ¼n ve haftanÄ±n yeri deÄŸiÅŸtirildi (Hafta solda)
            document.getElementById('days-value').textContent = totalDays.toString().padStart(2, '0');
            document.getElementById('weeks-value').textContent = totalWeeks.toString().padStart(2, '0');
            document.getElementById('hours-value').textContent = hoursLeft.toString().padStart(2, '0');
            document.getElementById('minutes-value').textContent = minutesLeft.toString().padStart(2, '0');
            document.getElementById('seconds-value').textContent = secondsLeft.toString().padStart(2, '0');

            // Ã‡emberleri GÃ¼ncelleme (Ã‡emberler iÃ§in maks deÄŸerler: 365 gÃ¼n, 52 hafta, 24 saat, 60 dakika, 60 saniye)
            updateCircle('days-circle', totalDays, 365); 
            updateCircle('weeks-circle', totalWeeks, 52); 
            updateCircle('hours-circle', hoursLeft, 24); 
            updateCircle('minutes-circle', minutesLeft, 60); 
            updateCircle('seconds-circle', secondsLeft, 60); 
        }

        function updateCircle(id, value, max) {
            const circle = document.getElementById(id);
            if (!circle) return;
            const percentage = (max - value) / max;
            const offset = YKS_CIRCUMFERENCE * percentage;
            circle.style.strokeDasharray = `${YKS_CIRCUMFERENCE} ${YKS_CIRCUMFERENCE}`;
            circle.style.strokeDashoffset = offset;
        }

        // =======================================
        // TARÄ°H VE ZAMAN YÃ–NETÄ°MÄ°
        // =======================================
        function getStartOfWeek(date) {
            const day = date.getDay(); // 0 (Pazar) - 6 (Cumartesi)
            const diff = date.getDate() - day + (day === 0 ? -6 : 1); // Pazartesiyi bul (TR'de hafta Pazartesi baÅŸlar)
            return new Date(date.getFullYear(), date.getMonth(), diff);
        }
        
        function getStorageKey(dayIndex) {
            return getStorageKeyByOffset(currentWeekOffset, dayIndex);
        }

        function getStorageKeyByOffset(weekOffset, dayIndex) {
            const today = new Date();
            const startOfCurrentWeek = getStartOfWeek(today);
            startOfCurrentWeek.setDate(startOfCurrentWeek.getDate() + weekOffset * 7);
            const targetDate = new Date(startOfCurrentWeek);
            targetDate.setDate(targetDate.getDate() + dayIndex);
            
            const month = targetDate.getMonth() + 1;
            const day = targetDate.getDate();
            const year = targetDate.getFullYear();
            
            return `tasks_${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        }
        
        function getScoreKey(dayIndex) {
            return `score_${getStorageKey(dayIndex)}`;
        }

        // =======================================
        // GÃ–REV YÃ–NETÄ°MÄ° (CRUD & RENDER)
        // =======================================
        function loadTasks(dayIndex) {
            const key = getStorageKey(dayIndex);
            const tasksJson = localStorage.getItem(key);
            let tasks = tasksJson ? JSON.parse(tasksJson) : [];
            
            // TamamlanmÄ±ÅŸ gÃ¶revleri sona taÅŸÄ±
            tasks.sort((a, b) => {
                if (a.completed && !b.completed) return 1;
                if (!a.completed && b.completed) return -1;
                return 0;
            });

            return tasks;
        }

        function saveTasks(dayIndex, tasks) {
            const key = getStorageKey(dayIndex);
            localStorage.setItem(key, JSON.stringify(tasks));
        }

        function reorderTasksInStorage(dayIndex) {
            const list = document.getElementById(`task-list-${dayIndex}`);
            if (!list) return;

            let reorderedTasks = [];
            list.querySelectorAll('.task-item').forEach(item => {
                const text = item.getAttribute('data-task-text');
                const isCompleted = item.classList.contains('completed');
                
                // Mevcut verilerden detaylarÄ± al (completedTime vb.)
                const existingTasks = loadTasks(dayIndex, false); 
                const existingTask = existingTasks.find(t => t.text === text);

                reorderedTasks.push({
                    text: text,
                    completed: isCompleted,
                    completedTime: existingTask ? existingTask.completedTime : null
                });
            });

            saveTasks(dayIndex, reorderedTasks);
        }
        
        function renderTasks(dayIndex) {
            const taskList = document.getElementById(`task-list-${dayIndex}`);
            if (!taskList) return;

            // Ã–nceki form varsa kapat
            closeOpenForm();
            
            const tasks = loadTasks(dayIndex);
            taskList.innerHTML = '';

            if (tasks.length === 0) {
                 taskList.innerHTML = `<li style="color: var(--text-color); opacity: 0.6; font-size: 0.9em; text-align: center; padding: 10px;">HenÃ¼z gÃ¶rev yok.</li>`;
            } else {
                 tasks.forEach(task => {
                    createTaskElement(taskList, dayIndex, task.text, task.completed);
                });
            }
            updateDayProgress(dayIndex);
            updateDayScoreDisplay(dayIndex); // GÃ¼nlÃ¼k sÃ¼reyi gÃ¼ncelle
        }

        function createTaskElement(taskList, dayIndex, text, completed = false) {
            const listItem = document.createElement('li');
            listItem.className = 'task-item' + (completed ? ' completed' : '');
            listItem.draggable = true;
            listItem.setAttribute('data-task-text', text);
            listItem.addEventListener('dragstart', (e) => {
                draggedItem = listItem;
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', text);
                listItem.classList.add('dragging');
                closeOpenForm();
            });
            listItem.addEventListener('dragend', () => {
                listItem.classList.remove('dragging');
            });

            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'task-content-wrapper';
            
            const taskSpan = document.createElement('span');
            taskSpan.className = 'task-text-content';
            taskSpan.textContent = text;
            taskSpan.style.color = 'var(--task-text-color)';
            taskSpan.style.wordBreak = 'break-word';

            const actionsDiv = document.createElement('div');
            actionsDiv.style.display = 'flex';
            actionsDiv.style.alignItems = 'center';
            actionsDiv.style.gap = '10px';
            actionsDiv.style.flexShrink = '0';
            actionsDiv.style.marginRight = '10px';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.checked = completed;
            checkbox.style.width = '16px';
            checkbox.style.height = '16px';
            checkbox.style.cursor = 'pointer';
            checkbox.onchange = function() {
                const isChecked = this.checked;
                updateTaskCompletion(dayIndex, text, isChecked);
                listItem.classList.toggle('completed', isChecked);
                reorderTasksInStorage(dayIndex);
                renderTasks(dayIndex); // Yeniden render ederek sÄ±ralama dÃ¼zeltilebilir

                if (isChecked) {
                    const userName = currentUser ? currentUser.displayName || fallbackUserName : fallbackUserName;
                    showCustomAlert(`Tebrikler, ${userName}! "${text}" gÃ¶revi tamamlandÄ±.`, '#22c55e');
                }
            };

            const moveButton = document.createElement('button');
            moveButton.innerHTML = '<i class="fas fa-arrow-right"></i>';
            moveButton.title = 'YarÄ±na TaÅŸÄ±';
            moveButton.style.backgroundColor = 'transparent';
            moveButton.style.color = 'var(--text-color)';
            moveButton.style.padding = '5px';
            moveButton.style.boxShadow = 'none';
            moveButton.style.transform = 'scale(1)';
            moveButton.onclick = (e) => {
                 e.stopPropagation();
                 moveTaskToNextDay(dayIndex, text);
            };

            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
            deleteButton.title = 'GÃ¶revi Sil';
            deleteButton.style.backgroundColor = 'transparent';
            deleteButton.style.color = 'var(--pomodoro-accent)';
            deleteButton.style.padding = '5px';
            deleteButton.style.boxShadow = 'none';
            deleteButton.style.transform = 'scale(1)';
            deleteButton.onclick = (e) => {
                e.stopPropagation();
                if (confirm(`"${text}" gÃ¶revini silmek istediÄŸinizden emin misiniz?`)) {
                    deleteTaskFromStorage(dayIndex, text);
                    showCustomAlert(`"${text}" gÃ¶revi silindi.`, '#f97316');
                    renderTasks(dayIndex);
                }
            };
            
            actionsDiv.appendChild(checkbox);
            actionsDiv.appendChild(moveButton);
            actionsDiv.appendChild(deleteButton);

            contentWrapper.appendChild(taskSpan);
            contentWrapper.appendChild(actionsDiv);
            
            listItem.appendChild(contentWrapper);
            taskList.appendChild(listItem);
        }

        function updateTaskCompletion(dayIndex, text, completed) {
            let tasks = loadTasks(dayIndex);
            const taskIndex = tasks.findIndex(task => task.text === text);
            if (taskIndex > -1) {
                tasks[taskIndex].completed = completed;
                tasks[taskIndex].completedTime = completed ? Date.now() : null;
                saveTasks(dayIndex, tasks);
            }
        }

        function deleteTaskFromStorage(dayIndex, text) {
            let tasks = loadTasks(dayIndex);
            tasks = tasks.filter(task => task.text !== text);
            saveTasks(dayIndex, tasks);
        }

        function moveTaskToNextDay(currentDayIndex, taskText) {
            let currentTasks = loadTasks(currentDayIndex);
            const taskToMove = currentTasks.find(task => task.text === taskText);
            if (!taskToMove) return;

            currentTasks = currentTasks.filter(task => task.text !== taskText);
            saveTasks(currentDayIndex, currentTasks);

            let nextDayIndex = currentDayIndex + 1;
            let nextWeekOffset = currentWeekOffset;
            if (nextDayIndex > 6) {
                nextDayIndex = 0;
                nextWeekOffset += 1;
            }
            
            const nextDayKey = getStorageKeyByOffset(nextWeekOffset, nextDayIndex);
            let nextDayTasksJson = localStorage.getItem(nextDayKey);
            let nextDayTasks = nextDayTasksJson ? JSON.parse(nextDayTasksJson) : [];
            
            if (nextDayTasks.some(t => t.text === taskText)) {
                showCustomAlert("Bu gÃ¶rev zaten hedef gÃ¼nde mevcut.", '#f97316');
                currentTasks.push(taskToMove); // TaÅŸÄ±ma baÅŸarÄ±sÄ±z, geri ekle
                saveTasks(currentDayIndex, currentTasks);
                renderTasks(currentDayIndex);
                return;
            }

            taskToMove.completed = false;
            taskToMove.completedTime = null;
            nextDayTasks.push(taskToMove);
            localStorage.setItem(nextDayKey, JSON.stringify(nextDayTasks));
            
            showCustomAlert(`${taskText} gÃ¶revi ${DAY_NAMES[nextDayIndex]} gÃ¼nÃ¼ne taÅŸÄ±ndÄ±.`, '#0ea5e9');
            renderTasks(currentDayIndex);
            
            // EÄŸer yeni gÃ¼n mevcut haftadaysa, onu da hemen render et
            if (nextWeekOffset === currentWeekOffset) {
                 renderTasks(nextDayIndex);
                 updateDayProgress(nextDayIndex);
            }
            updateDayProgress(currentDayIndex);
        }

        function showAddTaskForm(dayIndex) {
            if (openFormDayIndex !== null && openFormDayIndex !== dayIndex) {
                closeOpenForm();
            }
            const dayCell = document.getElementById(`day-${dayIndex}`);
            if (!dayCell) return;
            
            const existingForm = dayCell.querySelector('.add-task-form');
            if (existingForm) {
                // Form zaten aÃ§Ä±ksa kapat
                closeOpenForm();
                return;
            }

            const form = document.createElement('div');
            form.className = 'add-task-form';
            form.style.padding = '10px 0';
            form.style.marginTop = '10px';
            form.style.borderTop = '1px dashed var(--border-color)';
            
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = 'Yeni gÃ¶rev (Ã¶rn: Matematik 1s 30dk)';
            input.style.width = '100%';
            input.style.padding = '8px';
            input.style.marginBottom = '8px';
            input.style.border = '1px solid var(--accent-color)';
            input.style.borderRadius = '4px';
            input.style.backgroundColor = 'var(--task-bg)';
            input.style.color = 'var(--text-color)';
            input.focus();

            const button = document.createElement('button');
            button.textContent = 'Ekle';
            button.style.width = '100%';
            button.style.backgroundColor = 'var(--accent-color)';
            // Ä°kon ve metin Ã§akÄ±ÅŸmasÄ±nÄ± engellemek iÃ§in dÃ¼zeltme
            button.style.display = 'flex'; 
            button.style.justifyContent = 'center'; 
            button.style.gap = '8px';
            button.innerHTML = '<i class="fas fa-plus"></i> GÃ¶rev Ekle';


            button.onclick = () => {
                addTask(dayIndex, input.value);
            };
            
            input.onkeydown = (e) => {
                 if (e.key === 'Enter') {
                     addTask(dayIndex, input.value);
                 }
            };

            form.appendChild(input);
            form.appendChild(button);
            
            const cellContentWrapper = dayCell.querySelector('.cell-content-wrapper');
            if(cellContentWrapper) {
                 cellContentWrapper.appendChild(form);
            }
            
            openFormDayIndex = dayIndex;
        }

        function closeOpenForm() {
            if (openFormDayIndex === null) return;
            const dayCell = document.getElementById(`day-${openFormDayIndex}`);
            if (!dayCell) return;
            
            const form = dayCell.querySelector('.add-task-form');
            if (form) {
                form.remove();
            }
            openFormDayIndex = null;
        }

        function addTask(dayIndex, taskText) {
            taskText = taskText.trim();
            if (!taskText) {
                 showCustomAlert("LÃ¼tfen bir gÃ¶rev giriniz.", '#f97316');
                 return;
            }
            
            let tasks = loadTasks(dayIndex);
            if (tasks.some(t => t.text === taskText)) {
                 showCustomAlert("Bu gÃ¶rev zaten mevcut.", '#f97316');
                 return;
            }
            
            tasks.unshift({ text: taskText, completed: false, completedTime: null });
            saveTasks(dayIndex, tasks);
            
            showCustomAlert(`${DAY_NAMES[dayIndex]} gÃ¼nÃ¼ne yeni gÃ¶rev eklendi.`, '#38bdf8');
            renderTasks(dayIndex);
            closeOpenForm();
        }
        
        // =======================================
        // DRAG AND DROP YÃ–NETÄ°MÄ°
        // =======================================
        function handleDragOver(e) {
            e.preventDefault(); 
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            if (!draggedItem) return;
            
            const targetList = this; 
            const currentDayIndex = parseInt(targetList.dataset.dayIndex);
            const taskText = draggedItem.getAttribute('data-task-text');
            
            // EÄŸer aynÄ± gÃ¼n iÃ§indeyse, sadece DOM'u deÄŸiÅŸtir
            const sourceTaskList = draggedItem.closest('.task-list');
            const sourceDayIndex = parseInt(sourceTaskList.dataset.dayIndex);
            
            if (sourceDayIndex === currentDayIndex) {
                 // SÃ¼rÃ¼klenen Ã¶ÄŸeyi bÄ±rakÄ±lan yerin Ã¼stÃ¼ne ekle
                 const afterElement = getDragAfterElement(targetList, e.clientY);
                 if (afterElement == null) {
                     targetList.appendChild(draggedItem);
                 } else {
                     targetList.insertBefore(draggedItem, afterElement);
                 }
                 reorderTasksInStorage(currentDayIndex);
                 renderTasks(currentDayIndex); // Yeniden render ederek sÄ±ralama dÃ¼zeltilebilir
            } else {
                // FarklÄ± gÃ¼ne taÅŸÄ±nÄ±yorsa
                draggedItem.classList.remove('dragging');
                
                deleteTaskFromStorage(sourceDayIndex, taskText);

                let targetTasks = loadTasks(currentDayIndex);
                if (targetTasks.some(t => t.text === taskText)) {
                    showCustomAlert("Bu gÃ¶rev zaten hedef gÃ¼nde mevcut.", '#f97316');
                    renderTasks(sourceDayIndex); 
                    draggedItem = null;
                    return;
                }
                
                targetTasks.push({ text: taskText, completed: false, completedTime: null });
                saveTasks(currentDayIndex, targetTasks);
                
                showCustomAlert(`${taskText} gÃ¶revi ${DAY_NAMES[currentDayIndex]} gÃ¼nÃ¼ne taÅŸÄ±ndÄ±.`, '#0ea5e9');
                renderTasks(sourceDayIndex); 
                renderTasks(currentDayIndex);
            }
            
            draggedItem = null;
            updateDayProgress(currentDayIndex);
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];

            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function setupDragAndDropListeners() {
            const taskLists = document.querySelectorAll('.task-list');
            taskLists.forEach(list => {
                list.removeEventListener('dragover', handleDragOver);
                list.removeEventListener('drop', handleDrop);
                list.addEventListener('dragover', handleDragOver);
                list.addEventListener('drop', handleDrop);
            });
        }
        
        // =======================================
        // POMODORO VE SÃœRE YÃ–NETÄ°MÄ°
        // =======================================
        let timerInterval = null;
        let isTimerRunning = false;
        let isPaused = false;
        let initialSeconds = 25 * 60;
        let expectedTime = 0;
        let remainingTimeOnPause = initialSeconds * 1000;
        let audioPlayer;
        const musicVolume = 100;

        function savePomodoroState() {
            const state = {
                isRunning: isTimerRunning,
                isPaused: isPaused,
                initialSeconds: initialSeconds,
                remainingTime: isTimerRunning ? expectedTime - Date.now() : remainingTimeOnPause,
                timestamp: Date.now()
            };
            localStorage.setItem('pomodoroState', JSON.stringify(state));
        }

        function loadPomodoroState() {
            const stateJson = localStorage.getItem('pomodoroState');
            if (!stateJson) {
                updateTimerDisplay(initialSeconds * 1000);
                return;
            }

            const state = JSON.parse(stateJson);
            
            initialSeconds = state.initialSeconds;
            
            if (state.isRunning) {
                const elapsedSinceSave = Date.now() - state.timestamp;
                const remaining = state.remainingTime - elapsedSinceSave;
                
                if (remaining > 1000) { // 1 saniyeden fazla sÃ¼re kaldÄ±ysa devam et
                    remainingTimeOnPause = remaining;
                    isPaused = false;
                    startTimer(false); // BaÅŸlatma uyarÄ±sÄ± olmadan devam et
                } else {
                    // SÃ¼re dolduysa
                    remainingTimeOnPause = 0;
                    finishTimer(true); // SÃ¼re dolduÄŸu iÃ§in tamamla
                }
            } else if (state.isPaused) {
                remainingTimeOnPause = state.remainingTime;
                isPaused = true;
                updateTimerVisuals();
            } else {
                 remainingTimeOnPause = state.initialSeconds * 1000;
                 updateTimerDisplay(remainingTimeOnPause);
            }
            updateTimerInputs();
        }

        function showPomodoroModal() {
            document.getElementById('pomodoro-modal').style.display = 'flex';
            updateTimerVisuals();
        }

        function updateTimerFromInputs() {
            const hours = parseInt(document.getElementById('study-hours').value) || 0;
            const minutes = parseInt(document.getElementById('study-minutes').value) || 0;
            const seconds = parseInt(document.getElementById('study-seconds').value) || 0;
            initialSeconds = hours * 3600 + minutes * 60 + seconds;
        }

        function updateTimerFromInputsAndReset() {
            if (isTimerRunning || isPaused) {
                 showCustomAlert("SÃ¼reler, zamanlayÄ±cÄ± durdurulmuÅŸken deÄŸiÅŸtirilebilir. LÃ¼tfen Ã¶nce durdurun.", '#f97316');
                 // Eski deÄŸerleri geri yÃ¼kle
                 updateTimerInputs(); 
                 return;
            }
            updateTimerFromInputs();
            remainingTimeOnPause = initialSeconds * 1000;
            updateTimerDisplay(remainingTimeOnPause);
            savePomodoroState();
        }

        function updateTimerInputs() {
            const totalSeconds = initialSeconds;
            document.getElementById('study-hours').value = Math.floor(totalSeconds / 3600);
            document.getElementById('study-minutes').value = Math.floor((totalSeconds % 3600) / 60);
            document.getElementById('study-seconds').value = Math.floor(totalSeconds % 60);
        }

        function startTimer(showAlert = true) {
            if (isTimerRunning && !isPaused) return;

            if (initialSeconds <= 0) {
                 showCustomAlert("LÃ¼tfen geÃ§erli bir sÃ¼re ayarlayÄ±n.", '#f97316');
                 return;
            }
            
            if (!isTimerRunning) {
                // Ä°lk defa baÅŸlÄ±yorsa veya sÄ±fÄ±rdan baÅŸlÄ±yorsa
                updateTimerFromInputs();
                remainingTimeOnPause = initialSeconds * 1000;
            }

            expectedTime = Date.now() + remainingTimeOnPause;
            isTimerRunning = true;
            isPaused = false;

            if (showAlert) {
                 showCustomAlert("Odak sÃ¼resi baÅŸladÄ±!", '#bb86fc');
            }

            updateTimerVisuals();
            timerInterval = setInterval(tick, 1000);
            savePomodoroState();
        }

        function tick() {
            const remaining = expectedTime - Date.now();
            remainingTimeOnPause = remaining;

            if (remaining <= 0) {
                clearInterval(timerInterval);
                remainingTimeOnPause = 0;
                updateTimerDisplay(0);
                finishTimer(true); // SÃ¼re dolduÄŸu iÃ§in tamamla
                updateTimerVisuals();
                return;
            }
            updateTimerDisplay(remaining);
            savePomodoroState();
        }

        function pauseTimer() {
            if (!isTimerRunning || isPaused) return;
            clearInterval(timerInterval);
            isPaused = true;
            isTimerRunning = true; // Timer hala aktif ama duraklatÄ±ldÄ±
            showCustomAlert("SÃ¼re duraklatÄ±ldÄ±.", '#f97316');
            updateTimerVisuals();
            savePomodoroState();
        }

        function updateTimerVisuals() {
            const startBtn = document.getElementById('start-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const statusText = document.getElementById('pomodoro-status');
            
            if (isTimerRunning && !isPaused) {
                 if(startBtn) {
                     startBtn.style.display = 'none';
                     startBtn.style.opacity = '0';
                     startBtn.style.visibility = 'hidden';
                 }
                 if(pauseBtn) {
                     pauseBtn.style.display = 'flex';
                     pauseBtn.style.opacity = '1';
                     pauseBtn.style.visibility = 'visible';
                 }
                 if(statusText) statusText.textContent = "Ã‡ALIÅžIYOR...";
            } else {
                 if(startBtn) {
                     startBtn.style.display = 'flex';
                     startBtn.style.opacity = '1';
                     startBtn.style.visibility = 'visible';
                 }
                 if(pauseBtn) {
                     pauseBtn.style.display = 'none';
                     pauseBtn.style.opacity = '0';
                     pauseBtn.style.visibility = 'hidden';
                 }
                 if(statusText) statusText.textContent = isPaused ? "DURAKLATILDI" : "HazÄ±r.";
            }
            updateTimerDisplay(remainingTimeOnPause);
        }

        function hidePomodoroModal() {
            document.getElementById('pomodoro-modal').style.display = 'none';
        }

        function formatTime(totalSeconds) {
            totalSeconds = Math.max(0, totalSeconds || 0);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay(remainingTimeMs) {
            const display = document.getElementById('timer-display');
            if (display) {
                 display.textContent = formatTime(Math.ceil(remainingTimeMs / 1000));
            }
        }

        function resetTimer(restoreInputs = true, showResetAlert = true) {
            clearInterval(timerInterval);
            isTimerRunning = false;
            isPaused = false;
            if (restoreInputs) {
                 updateTimerFromInputs();
            }
            remainingTimeOnPause = initialSeconds * 1000;
            updateTimerVisuals();
            if(showResetAlert) {
                 showCustomAlert("ZamanlayÄ±cÄ± sÄ±fÄ±rlandÄ±.", '#0ea5e9');
            }
            savePomodoroState();
        }

        function finishTimer(isCompleted = false) {
            clearInterval(timerInterval);
            const initialMs = initialSeconds * 1000;
            const remainingMs = Math.max(0, remainingTimeOnPause);
            const workedTimeMs = initialMs - remainingMs;
            const workedMinutes = Math.round(workedTimeMs / 60000);

            isTimerRunning = false;
            isPaused = false;
            
            if (workedMinutes > 0) {
                 const dayIndex = (new Date().getDay() + 6) % 7; // Pazartesi = 0
                 const dayName = DAY_NAMES[dayIndex];
                 saveStudyScore(dayIndex, workedMinutes);

                 const formattedScore = formatMinutesToHoursMinutes(workedMinutes);
                 const userName = currentUser ? currentUser.displayName || fallbackUserName : fallbackUserName;
                 let message;
                 if (isCompleted) {
                     message = `Tebrikler, ${userName}! ${formattedScore} Ã§alÄ±ÅŸma baÅŸarÄ±yla tamamlandÄ± ve ${dayName} gÃ¼nÃ¼ne kaydedildi.`;
                     if(audioPlayer) audioPlayer.play();
                 } else {
                     message = `${userName}, ${formattedScore} Ã§alÄ±ÅŸma ${dayName} gÃ¼nÃ¼ne kaydedildi.`;
                 }
                 showCustomAlert(message, '#38bdf8');
            } else if (!isCompleted) {
                 showCustomAlert("Kaydedilecek sÃ¼re bulunamadÄ±.", '#f97316');
            }

            resetTimer(true, false);
            savePomodoroState();
        }

        // =======================================
        // PUAN YÃ–NETÄ°MÄ°
        // =======================================
        function loadStudyScore(dayIndex) {
            const key = getScoreKey(dayIndex);
            return parseInt(localStorage.getItem(key)) || 0;
        }

        function saveStudyScore(dayIndex, minutes) {
            const currentScore = loadStudyScore(dayIndex);
            localStorage.setItem(getScoreKey(dayIndex), currentScore + minutes);
            updateAllDayScoresAndToday();
            updateDayScoreDisplay(dayIndex); // Skor deÄŸiÅŸince gÃ¼n baÅŸlÄ±ÄŸÄ±nÄ± da gÃ¼ncelle
        }
        
        function formatMinutesToHoursMinutes(totalMinutes) {
            if (totalMinutes < 60) return `${totalMinutes} dk`;
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            if (minutes === 0) return `${hours} sa`;
            return `${hours} sa ${minutes} dk`;
        }

        function updateDayScoreDisplay(dayIndex) {
            const scoreElement = document.getElementById(`day-score-${dayIndex}`);
            if (scoreElement) {
                const score = loadStudyScore(dayIndex);
                scoreElement.textContent = `Ã‡alÄ±ÅŸma: ${formatMinutesToHoursMinutes(score)}`;
            }
        }

        function updateDayProgress(dayIndex) {
            const taskList = document.getElementById(`task-list-${dayIndex}`);
            if (!taskList) return;

            const allTasks = loadTasks(dayIndex);
            const totalTasks = allTasks.length;
            const completedTasks = allTasks.filter(t => t.completed).length;

            const progressContainer = document.getElementById(`progress-container-${dayIndex}`);
            const progressFill = document.getElementById(`progress-fill-${dayIndex}`);
            const percentageText = document.getElementById(`progress-percentage-${dayIndex}`);

            if (!progressContainer || !progressFill || !percentageText) return;
            
            if (totalTasks === 0) {
                 progressContainer.style.display = 'none';
                 return;
            }
            
            progressContainer.style.display = 'block';
            
            const percentage = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
            progressFill.style.width = `${percentage}%`;
            percentageText.textContent = `${Math.round(percentage)}%`;

            if (percentage === 100 && totalTasks > 0) {
                 progressFill.classList.add('complete');
            } else {
                 progressFill.classList.remove('complete');
            }
        }
        
        function updateAllDayScoresAndToday() {
            let allTimeScore = 0;
            let todayScore = 0;

            const today = new Date();
            const todayKeyPrefix = getStorageKeyByOffset(0, (today.getDay() + 6) % 7).split('_').slice(1).join('_');

            // TÃ¼m gÃ¶revleri ve skorlarÄ± kontrol et
            for (let i = -5; i <= 5; i++) { // Ã–nceki/sonraki 5 haftayÄ± kontrol et
                for (let j = 0; j < 7; j++) {
                    const key = getStorageKeyByOffset(i, j);
                    
                    // SkorlarÄ± topla
                    const score = parseInt(localStorage.getItem(`score_${key}`)) || 0;
                    allTimeScore += score;
                    
                    // BugÃ¼nÃ¼n skorunu topla
                    const currentKeyPrefix = key.split('_').slice(1).join('_');
                    if (currentKeyPrefix === todayKeyPrefix) {
                         todayScore = score; // Tekrar atama, Ã§Ã¼nkÃ¼ bugÃ¼n sadece bir key'e sahip
                    }
                }
            }

            document.getElementById('all-time-score').textContent = `ðŸ† Toplam: ${formatMinutesToHoursMinutes(allTimeScore)}`;
            document.getElementById('today-worked-time').textContent = `â±ï¸ BugÃ¼n: ${formatMinutesToHoursMinutes(todayScore)}`;
        }


        function getNumber(value) {
            return parseInt(value) || 0;
        }

        function showCustomAlert(message, backgroundColor = '#ef4444', duration = 4000) {
            const alertBox = document.getElementById('custom-alert');
            if (!alertBox) return;
            alertBox.style.backgroundColor = backgroundColor;
            alertBox.textContent = message;
            alertBox.style.opacity = '1';
            alertBox.style.top = '30px';
            setTimeout(() => {
                alertBox.style.opacity = '0';
                alertBox.style.top = '-50px';
            }, duration);
        }

        // =======================================
        // BAÅžLANGIÃ‡
        // =======================================
        function createDayCells() {
            const grid = document.querySelector('.schedule-grid');
            if (!grid) return;
            let htmlContent = '';
            for (let i = 0; i < 7; i++) {
                htmlContent += `
                    <div class="day-cell" id="day-${i}" data-day-index="${i}">
                        <h3 class="day-header">${DAY_NAMES[i]} <span id="date-${i}" style="font-size: 0.7em; opacity: 0.8; font-weight: 500;"></span></h3>
                        <span class="day-score-display" id="day-score-${i}">Ã‡alÄ±ÅŸma: 0 dk</span>
                        
                        <div class="day-progress-area">
                            <div class="day-progress-container" id="progress-container-${i}" style="display: none;">
                                <div class="day-progress-fill" id="progress-fill-${i}" style="width: 0%;"></div>
                                <span class="day-progress-percentage" id="progress-percentage-${i}">0%</span>
                            </div>
                        </div>

                        <div class="cell-content-wrapper">
                            <ul class="task-list" id="task-list-${i}" data-day-index="${i}">
                                </ul>
                        </div>

                        <button class="add-task-btn" onclick="showAddTaskForm(${i})" style="background-color: var(--button-bg);"><i class="fas fa-plus"></i> GÃ¶rev Ekle</button>
                    </div>
                `;
            }
            grid.innerHTML = htmlContent;
        }

        function renderSchedule() {
            const today = new Date();
            const startOfCurrentWeek = getStartOfWeek(today);
            startOfCurrentWeek.setDate(startOfCurrentWeek.getDate() + currentWeekOffset * 7);

            const weekDisplay = document.getElementById('week-display');
            if (weekDisplay) {
                if (currentWeekOffset === 0) {
                    weekDisplay.textContent = 'Mevcut Hafta';
                } else if (currentWeekOffset === -1) {
                    weekDisplay.textContent = 'GeÃ§en Hafta';
                } else if (currentWeekOffset === 1) {
                    weekDisplay.textContent = 'Gelecek Hafta';
                } else {
                    const endOfWeek = new Date(startOfCurrentWeek);
                    endOfWeek.setDate(endOfWeek.getDate() + 6);
                    weekDisplay.textContent = `${startOfCurrentWeek.toLocaleDateString('tr-TR')} - ${endOfWeek.toLocaleDateString('tr-TR')}`;
                }
            }

            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(startOfCurrentWeek);
                dayDate.setDate(dayDate.getDate() + i);
                const dateElement = document.getElementById(`date-${i}`);
                if (dateElement) {
                    dateElement.textContent = `(${dayDate.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' })})`;
                }

                renderTasks(i);

                const dayCell = document.getElementById(`day-${i}`);
                if (dayCell) {
                    const isToday = currentWeekOffset === 0 && dayDate.toDateString() === today.toDateString();
                    dayCell.style.border = isToday ? `2px solid var(--pomodoro-accent)` : `var(--day-border)`;
                    dayCell.style.boxShadow = isToday ? `0 0 10px rgba(248, 113, 113, 0.5)` : 'none';
                }
            }

            updateAllDayScoresAndToday();
            setupDragAndDropListeners();
        }

        function changeWeek(direction) {
            currentWeekOffset += direction;
            updateURL();
            renderSchedule();
        }

        function updateURL() {
            const url = new URL(window.location);
            url.searchParams.set('week', currentWeekOffset);
            window.history.pushState({}, '', url);
        }

        function loadWeekFromURL() {
            const params = new URLSearchParams(window.location.search);
            currentWeekOffset = parseInt(params.get('week')) || 0;
        }


        document.addEventListener('DOMContentLoaded', () => {
            createDayCells();
            audioPlayer = document.getElementById('audio-player');
            audioPlayer.volume = musicVolume / 100;

            loadTheme();
            loadWeekFromURL();
            loadPomodoroState();
            
            initFirebaseAuth();

            updateCountdown();
            window.yksInterval = setInterval(updateCountdown, 1000);
            
            document.querySelectorAll('input[type="text"]').forEach(input => {
                input.addEventListener('focus', closeOpenForm);
            });
            
            document.getElementById('study-hours').addEventListener('input', updateTimerFromInputsAndReset);
            document.getElementById('study-minutes').addEventListener('input', updateTimerFromInputsAndReset);
            document.getElementById('study-seconds').addEventListener('input', updateTimerFromInputsAndReset);
            
            window.onpopstate = () => {
                loadWeekFromURL();
                renderSchedule();
            };
        });

    </script>
</body>
</html>
