<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COSX √ñMER DERS √áƒ∞ZELGESƒ∞ - LUXURY PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&family=Playfair+Display:ital,wght@1,700;1,900&display=swap" rel="stylesheet">
    
    <style>
        /* ======================================= */
        /* TEMEL STƒ∞LLER VE TEMA DEƒûƒ∞≈ûKENLERƒ∞ */
        /* ======================================= */
        :root {
            /* Varsayƒ±lan Tema (LUXURY DARK MODE) */
            --bg-color: #0d0e14; 
            --container-bg: #1e2029; 
            --header-bg: #14161c; 
            --header-text: #ffffff;
            --text-color: #c9d1d9; 
            --border-color: #383a47;
            --day-bg: #1e2029; 
            --accent-color: #bb86fc; 
            --accent-glow: rgba(187, 134, 252, 0.7); 
            --button-bg: #30363d; 
            --button-hover: #40454c;
            --progress-bg: #30363d;
            --progress-fill: #bb86fc;
            --progress-complete: #fbc02d; 
            --pomodoro-bg: #14161c;
            --pomodoro-accent: #f87171; 
            --logo-content: "ODAK VE BA≈ûARI Y√ñNETƒ∞Mƒ∞"; 
            --logo-accent: #fbc02d; 
            --task-bg: #272a33;
            --task-completed-bg: #383a47;
            --day-header-color: #e5e7eb;
            --task-text-color: #ffffff;
            --theme-icon-color: #c9d1d9;
            --day-border: 1px solid #383a47; 
            --instagram-bg: #30363d;
            --instagram-text: #c9d1d9;
            --theme-controls-bg: #272a33; 

            /* Geri Sayƒ±m Saya√ß Renkleri (YENƒ∞ MODERN STƒ∞L) */
            --countdown-bg: #14161c; /* Arka plan koyu */
            --countdown-fill: #00bcd4; /* G√∂z alƒ±cƒ± √áer√ßeve rengi (CYAN) */
            --countdown-text: #ffffff;
            --countdown-shadow: rgba(0, 188, 212, 0.8);
        }

        /* KLASƒ∞K TEMA (Soft Gray) */
        body[data-theme="light"] {
            --bg-color: #f0f4f7; 
            --container-bg: #ffffff;
            --header-bg: #1f2937; 
            --header-text: #ffffff;
            --text-color: #1f2937; 
            --border-color: #e5e7eb; 
            --day-bg: #ffffff; 
            --accent-color: #059669; 
            --accent-glow: rgba(5, 150, 105, 0.4);
            --button-bg: #4f46e5;
            --button-hover: #4338ca;
            --progress-bg: #f3f4f6;
            --progress-fill: #059669;
            --progress-complete: #10b981; 
            --pomodoro-bg: #ffffff;
            --pomodoro-accent: #dc2626; 
            --logo-content: "ODAK VE BA≈ûARI Y√ñNETƒ∞Mƒ∞";
            --logo-accent: #059669;
            --task-bg: #f9fafb;
            --task-completed-bg: #e5e7eb;
            --day-header-color: #1f2937; 
            --task-text-color: #1f2937; 
            --theme-icon-color: #ffffff;
            --day-border: 1px solid #e5e7eb; 
            --instagram-bg: #4f46e5;
            --instagram-text: #ffffff;
            --theme-controls-bg: #9ca3af; 

            --countdown-bg: #e5e7eb;
            --countdown-fill: #dc2626; /* KIRMIZI */
            --countdown-text: #1f2937;
            --countdown-shadow: rgba(220, 38, 38, 0.6);
        }

        /* HELLO KITTY TEMASI (Pink Revizyonu) */
        body[data-theme="kitty"] {
            --bg-color: #ffeef2; 
            --container-bg: #ffffff;
            --header-bg: #f8a4b4; 
            --header-text: #8b0000; 
            --text-color: #4b0082; 
            --border-color: #ffc0cb; 
            --day-bg: #ffffff; 
            --accent-color: #ff1493; 
            --accent-glow: rgba(255, 20, 147, 0.7);
            --button-bg: #ff69b4; 
            --button-hover: #ff1493;
            --progress-bg: #ffe4e1; 
            --progress-fill: #ff1493; 
            --progress-complete: #ff69b4; 
            --pomodoro-bg: #ffffff;
            --pomodoro-accent: #dc143c; 
            --logo-content: "üéÄ SEVƒ∞MLƒ∞ √áALI≈ûMA ALANI üéÄ"; 
            --logo-accent: #ff1493;
            --task-bg: #fff0f5; 
            --task-completed-bg: #fce7f3;
            --day-header-color: #8b0000;
            --task-text-color: #4b0082;
            --theme-icon-color: #ffffff;
            --day-border: 1px solid #ffc0cb; 
            --instagram-bg: #ff69b4;
            --instagram-text: #ffffff;
            --theme-controls-bg: #fbcfe2; 

            --countdown-bg: #ffe4e1;
            --countdown-fill: #4b0082; /* MOR */
            --countdown-text: #8b0000;
            --countdown-shadow: rgba(75, 0, 130, 0.6);
        }
        
        /* SPIDERMAN - KORUMALI TEMA */
         body[data-theme="spiderman"] {
            --bg-color: #c0392b; 
            --container-bg: #2c3e50; 
            --header-bg: #2c3e50; 
            --header-text: #ecf0f1; 
            --text-color: #ecf0f1; 
            --border-color: #34495e; 
            --day-bg: #34495e; 
            --accent-color: #f1c40f; 
            --accent-glow: rgba(241, 196, 15, 0.7);
            --button-bg: #e74c3c; 
            --button-hover: #c0392b; 
            --progress-bg: #3498db;
            --progress-fill: #f1c40f; 
            --progress-complete: #2ecc71;
            --pomodoro-bg: #2c3e50;
            --pomodoro-accent: #f1c40f; 
            --logo-content: "üï∏Ô∏è MARVELOUS STUDY üï∏Ô∏è";
            --logo-accent: #ffffff; 
            --task-bg: #34495e;
            --task-completed-bg: #475569;
            --day-header-color: #ffffff;
            --task-text-color: #ecf0f1;
            --theme-icon-color: #ecf0f1;
            --day-border: 1px solid #475569; 
            --instagram-bg: #e74c3c;
            --instagram-text: #ffffff;
            --theme-controls-bg: #34495e; 

            --countdown-bg: #34495e;
            --countdown-fill: #3498db; /* MAVƒ∞ */
            --countdown-text: #ffffff;
            --countdown-shadow: rgba(52, 152, 219, 0.8);
        }

        /* RESETLER */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
        }

        /* BUTON STƒ∞Lƒ∞ */
        button {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            background-color: var(--button-bg);
            color: var(--header-text); 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transform: scale(1);
        }
        
        button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        /* ======================================= */
        /* LAYOUT VE BA≈ûLIK STƒ∞Lƒ∞ */
        /* ======================================= */
        .container {
            max-width: 1600px; 
            margin: 0 auto;
            background-color: var(--container-bg);
            border-radius: 16px; 
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5); 
            overflow: hidden;
            min-width: 1000px; 
            position: relative; 
        }
        
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 30px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
            gap: 20px;
            border-bottom: 2px solid var(--border-color);
        }
        
        /* L√úKS BA≈ûLIK STƒ∞Lƒ∞ */
        header h1 {
            font-size: 2.5em;
            font-weight: 900; 
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--header-text);
            padding-top: 10px;
        }
        
        header h1::before {
             content: 'COSX √ñMER';
             display: block;
             font-size: 2.2em;
             font-weight: 900; 
             font-family: 'Playfair Display', serif; 
             font-style: italic; 
             margin-bottom: 5px;
             color: var(--logo-accent);
             text-shadow: 0 0 15px var(--accent-glow); 
             letter-spacing: 2px;
             line-height: 1;
        }

        header h1::after {
            content: var(--logo-content);
            display: block;
            font-size: 0.6em;
            margin-top: 5px;
            font-weight: 400;
            letter-spacing: 2px;
            color: var(--text-color); 
        }
        
        /* HAFTALIK S√úRE G√ñSTERƒ∞Mƒ∞ GLOW */
        .header-stats > span {
            font-size: 1.1em;
            font-weight: 700;
            padding: 8px 15px;
            border-radius: 8px;
            background-color: var(--task-bg);
            border: 1px solid var(--accent-color);
            box-shadow: 0 0 8px var(--accent-glow); 
            color: var(--accent-color);
            margin-right: 15px;
        }

        #today-worked-time {
            border: 1px solid var(--pomodoro-accent);
            color: var(--pomodoro-accent);
            box-shadow: 0 0 8px rgba(248, 113, 113, 0.5);
        }
        
        /* TEMA KONTROLLERƒ∞ VE MODERƒ∞N BUTONLAR */
        .header-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .theme-controls {
             display: flex;
             gap: 8px;
             padding: 5px;
             border-radius: 12px;
             background-color: var(--theme-controls-bg); 
             border: 1px solid var(--border-color);
        }
        
        .theme-button {
             background: none;
             padding: 8px;
             border-radius: 8px;
             font-size: 1.2em;
             color: var(--theme-icon-color);
             box-shadow: none;
             transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
        }
        
        .theme-button:hover {
            background-color: var(--button-hover);
        }
        
        .theme-button.active {
            background-color: var(--accent-color);
            color: var(--header-text);
            box-shadow: 0 0 10px var(--accent-glow);
            border: 1px solid var(--header-text);
        }

        /* INSTAGRAM LOGO/LINK STƒ∞Lƒ∞ */
        #instagram-link {
            background-color: var(--instagram-bg); 
            color: var(--instagram-text);
            font-size: 1em;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: color 0.3s, box-shadow 0.3s, background-color 0.3s;
            font-weight: 600;
        }
        
        #instagram-link:hover {
            color: var(--accent-color);
            border-color: var(--accent-color);
            box-shadow: 0 0 10px var(--accent-glow);
        }


        /* ======================================= */
        /* G√ñREV ANA ƒ∞√áERƒ∞K YAPISI (YENƒ∞ FLEX D√úZENƒ∞) */
        /* ======================================= */
        .main-content {
            display: flex;
            padding: 0 40px 40px 40px; 
            gap: 30px; 
        }

        #schedule-container {
            flex-grow: 1; 
            min-width: 100%; 
        }
        
        /* ======================================= */
        /* YKS GERƒ∞ SAYIM SAYACI STƒ∞LLERƒ∞ (YENƒ∞ YATAY VE √úSTTE) */
        /* ======================================= */
        #yks-countdown-container {
            width: 100%; /* Tam Geni≈ülik */
            padding: 20px 40px; /* Kenar bo≈üluklarƒ±yla uyumlu */
            background-color: var(--header-bg); /* √úst √ßubuk ile uyumlu arkaplan */
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: center; /* Ortala */
            align-items: center;
            gap: 30px; /* Sayƒ±cƒ±lar arasƒ± bo≈üluk */
        }
        
        #yks-countdown-container h2 {
            font-size: 1.2em;
            font-weight: 900;
            color: var(--logo-accent);
            text-shadow: 0 0 10px rgba(251, 192, 45, 0.5);
            padding-right: 30px;
            border-right: 1px solid var(--border-color);
            line-height: 1.2;
            text-align: right;
            min-width: 150px;
        }
        
        /* YKS Sayacƒ± Ana Grubu */
        .countdown-group {
             display: flex;
             gap: 20px;
             align-items: center;
             flex-grow: 1; 
             justify-content: center;
        }

        .countdown-item {
            width: 90px; /* Daha k√º√ß√ºk kare boyut */
            height: 90px; 
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .countdown-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg); 
        }
        
        /* Arka plan √ßemberi - daha kalƒ±n ve koyu */
        .countdown-circle-bg {
            fill: none;
            stroke: var(--countdown-bg);
            stroke-width: 8; 
        }
        
        /* Doluluk √ßemberi - akƒ±cƒ± animasyon i√ßin */
        .countdown-circle-fill {
            fill: none;
            stroke: var(--countdown-fill);
            stroke-width: 6; 
            stroke-linecap: round; 
            transition: stroke-dashoffset 0.9s linear; 
            filter: drop-shadow(0 0 3px var(--countdown-shadow)); 
        }
        
        .countdown-value {
            position: absolute;
            text-align: center;
            color: var(--countdown-text);
        }
        
        .countdown-value strong {
            display: block;
            font-size: 2.2em; /* Yazƒ± boyutu k√º√ß√ºlt√ºld√º */
            font-weight: 900;
            line-height: 1;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        .countdown-value span {
            display: block;
            font-size: 0.7em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 3px;
            color: var(--text-color);
        }
        
        #yks-target-date {
            font-size: 0.8em; 
            padding-left: 30px;
            border-left: 1px solid var(--border-color);
            white-space: nowrap;
            color: var(--text-color);
        }

        /* ======================================= */
        /* G√ñREV √ñƒûESƒ∞ VE Y√úZDE √áUBUƒûU */
        /* ======================================= */
        
        .task-item {
             position: relative;
             display: flex;
             flex-direction: column; 
             align-items: flex-start; 
             cursor: move; 
             padding: 10px 15px; 
             margin-bottom: 8px;
             background-color: var(--task-bg);
             border-radius: 6px;
             border-left: 5px solid transparent; 
             transition: all 0.2s ease;
             line-height: 1.3; 
        }
        
        .task-item:hover {
            border-left-color: var(--accent-color);
            box-shadow: 0 0 5px var(--accent-glow);
        }
        .task-item.dragging {
            opacity: 0.5;
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            cursor: grabbing;
        }
        
        .task-content-wrapper {
             width: 100%;
             display: flex;
             align-items: flex-start; 
             justify-content: space-between;
        }
        
        .task-item.completed {
            border-left-color: var(--progress-complete); 
            opacity: 0.85;
            box-shadow: 0 0 10px rgba(251, 192, 45, 0.7); 
            cursor: move; 
        }
        
        .task-item.completed .task-text-content:after {
            content: " [Bitti]"; 
            color: var(--progress-complete);
            font-size: 0.8em; 
            font-weight: 700;
            margin-left: 5px;
            text-shadow: 0 0 3px var(--progress-complete); 
        }
        
        .day-progress-area {
            margin: 10px 0 15px 0;
            text-align: center;
            position: relative;
        }

        .day-progress-container {
            width: 100%;
            height: 12px;
            background-color: var(--progress-bg);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .day-progress-fill {
            height: 100%;
            background-color: var(--progress-fill);
            transition: width 0.5s ease-in-out, background-color 0.5s;
            position: relative;
        }
        
        .day-progress-fill.complete {
             background-color: var(--progress-complete);
             box-shadow: 0 0 15px var(--progress-complete);
             filter: brightness(1.2);
        }
        
        .day-progress-percentage {
            position: absolute;
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 0.9em;
            font-weight: 800; 
            color: var(--header-text); 
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5); 
            z-index: 5;
        }
        
        /* ======================================= */
        /* POMODORO MODAL D√úZELTMELERƒ∞ */
        /* ======================================= */
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9); 
            display: none;
            justify-content: center;
            align-items: center; 
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .pomodoro-content {
            background-color: var(--pomodoro-bg); 
            padding: 50px; 
            border-radius: 16px; 
            box-shadow: 0 0 50px var(--accent-glow); 
            max-width: 600px; 
            width: 90%; 
            text-align: center; 
            position: relative;
            border: 2px solid var(--accent-color);
        }
        
        .timer-display {
            font-size: 6em; 
            font-weight: 900; 
            color: var(--pomodoro-accent); 
            letter-spacing: 2px; 
            margin: 10px 0;
            text-shadow: 0 0 10px rgba(248, 113, 113, 0.7);
        }
        
        .timer-controls {
            display: flex;
            justify-content: center; 
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .timer-controls button {
             padding: 12px 25px;
             font-size: 1.1em;
             min-width: 120px;
             
        }
        
        .timer-controls > div { 
            position: relative; 
            width: 140px; 
            height: 50px; 
        }
        
        .timer-controls > div button {
            position: absolute; 
            width: 100%; 
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* G√ñREV TABLOSU D√úZENƒ∞ */
        .schedule-grid {
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            border-top: 1px solid var(--border-color); 
            overflow-x: auto; 
            min-width: 100%; 
        }
        
        .day-cell {
             padding: 20px 15px; 
             border-right: var(--day-border); 
             background-color: var(--day-bg); 
             min-height: 550px; 
             display: flex; 
             flex-direction: column;
        }
        
        .schedule-grid > .day-cell:last-child {
            border-right: none;
        }
        
        .cell-content-wrapper {
             flex-grow: 1; 
             display: flex; 
             flex-direction: column;
        }
        
        .add-task-btn {
            margin-top: auto; 
        }

    </style>
</head>
<body>

    <div id="custom-alert" class="alert-box" style="position: fixed; top: -50px; left: 50%; transform: translateX(-50%); background-color: #ef4444; color: white; padding: 15px 30px; border-radius: 8px; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3); z-index: 2000; font-weight: 600; opacity: 0; transition: opacity 0.5s, top 0.5s;"></div> 
    
    <div class="container">
        <header>
            <h1></h1>
            <div class="header-controls">
                
                <div class="theme-controls">
                    <button class="theme-button active" id="default-btn" onclick="setTheme('default', this)" title="Luxury Dark Mode"><i class="fas fa-gem"></i></button>
                    <button class="theme-button" id="light-btn" onclick="setTheme('light', this)" title="Classic Mode (Soft Gray)"><i class="fas fa-sun"></i></button>
                    <button class="theme-button" id="kitty-btn" onclick="setTheme('kitty', this)" title="Hello Kitty Tema (Pink Edition)"><i class="fas fa-heart"></i></button>
                    <button class="theme-button" id="spiderman-btn" onclick="setTheme('spiderman', this)" title="Spiderman Tema"><i class="fas fa-spider"></i></button>
                </div>
                
                <a id="instagram-link" href="https://instagram.com/cosxomer" target="_blank" title="Instagram Profilim">
                    <i class="fab fa-instagram"></i> /cosxomer
                </a>

                <div class="header-stats">
                    <span id="weekly-total-time">HAFTA: 0 sa 0 dk</span>
                    <span id="today-worked-time">BUG√úN: 0 dk</span>
                </div>
                
                <button class="pomodoro-btn" onclick="showPomodoroModal()">üçÖ Pomodoro Ba≈ülat</button>
            </div>
        </header>

        <div class="week-nav" style="padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; background-color: var(--button-bg); color: var(--header-text); font-weight: 600;">
            <button class="nav-btn" onclick="changeWeek(-1)" style="background: none; border: 1px solid var(--header-text);">‚¨Ö √ñnceki Hafta</button>
            <span id="week-info" style="font-weight: 900; color: var(--logo-accent);"></span>
            <button class="nav-btn" onclick="changeWeek(1)" style="background: none; border: 1px solid var(--header-text);">Sonraki Hafta ‚û°</button>
        </div>
        
        <div id="yks-countdown-container">
            <h2>YKS (TYT) <br> GERƒ∞ SAYIM</h2>
            
            <div class="countdown-group">
                <div class="countdown-item">
                    <svg class="countdown-svg" viewBox="0 0 70 70">
                        <circle class="countdown-circle-bg" cx="35" cy="35" r="30"></circle>
                        <circle id="days-circle" class="countdown-circle-fill" cx="35" cy="35" r="30"></circle>
                    </svg>
                    <div class="countdown-value">
                        <strong id="days-value">0</strong>
                        <span>G√úN</span>
                    </div>
                </div>
                
                <div class="countdown-item">
                    <svg class="countdown-svg" viewBox="0 0 70 70">
                        <circle class="countdown-circle-bg" cx="35" cy="35" r="30"></circle>
                        <circle id="hours-circle" class="countdown-circle-fill" cx="35" cy="35" r="30"></circle>
                    </svg>
                    <div class="countdown-value">
                        <strong id="hours-value">00</strong>
                        <span>SAAT</span>
                    </div>
                </div>
                
                <div class="countdown-item">
                    <svg class="countdown-svg" viewBox="0 0 70 70">
                        <circle class="countdown-circle-bg" cx="35" cy="35" r="30"></circle>
                        <circle id="minutes-circle" class="countdown-circle-fill" cx="35" cy="35" r="30"></circle>
                    </svg>
                    <div class="countdown-value">
                        <strong id="minutes-value">00</strong>
                        <span>DK</span>
                    </div>
                </div>
                
                <div class="countdown-item">
                    <svg class="countdown-svg" viewBox="0 0 70 70">
                        <circle class="countdown-circle-bg" cx="35" cy="35" r="30"></circle>
                        <circle id="seconds-circle" class="countdown-circle-fill" cx="35" cy="35" r="30"></circle>
                    </svg>
                    <div class="countdown-value">
                        <strong id="seconds-value">00</strong>
                        <span>SN</span>
                    </div>
                </div>
            </div>
            
            <p id="yks-target-date">
                Hedef: 21 Haziran @ 10:00
            </p>
            
        </div>
        <div class="main-content">
            
            <div id="schedule-container">
                <div class="schedule-grid">
                    </div>
            </div>
        </div>
        
    </div>
    
    <div id="pomodoro-modal" class="modal-overlay">
        <div class="pomodoro-content">
            <button id="close-pomodoro-btn" onclick="hidePomodoroModal()" style="position: absolute; top: 15px; right: 15px; background: var(--button-bg); color: var(--text-color); padding: 8px 12px;">KAPAT</button>
            <h2 style="text-align: center; font-size: 1.8em; color: var(--header-text); margin-bottom: 20px;">üçÖ ODAK ZAMANI</h2>

            <div class="time-inputs" style="display: flex; justify-content: center; gap: 15px; margin: 20px 0;">
                <div><label for="study-hours" style="color: var(--text-color);">Saat:</label><input type="number" id="study-hours" value="0" min="0" max="10" style="width: 60px; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; text-align: center; background: var(--task-bg); color: var(--text-color);"></div>
                <div><label for="study-minutes" style="color: var(--text-color);">Dakika:</label><input type="number" id="study-minutes" value="25" min="0" max="59" style="width: 60px; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; text-align: center; background: var(--task-bg); color: var(--text-color);"></div>
                <div><label for="study-seconds" style="color: var(--text-color);">Saniye:</label><input type="number" id="study-seconds" value="0" min="0" max="59" style="width: 60px; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; text-align: center; background: var(--task-bg); color: var(--text-color);"></div>
            </div>

            <div id="timer-display" class="timer-display">00:25:00</div>
            <div id="timer-status" class="timer-status" style="color: var(--accent-color); font-weight: 600; margin-bottom: 20px;">Hazƒ±r.</div>

            <div class="timer-controls">
                <button id="reset-btn" onclick="resetTimer(true, true)">SIFIRLA</button>
                <div style="position: relative; width: 140px; height: 50px;"> 
                    <button id="start-btn" onclick="startTimer()">BA≈ûLAT</button>
                    <button id="pause-btn" style="display:none; opacity: 0; visibility: hidden;" onclick="pauseTimer()">DURAKLAT</button>
                </div>
                <button id="finish-btn" onclick="finishTimer(false)" style="background-color: var(--accent-color);">KAYDET & Bƒ∞Tƒ∞R</button>
            </div>
            
        </div>
    </div>
    
    <audio id="audio-player" loop></audio>
    
    <script>
        // =======================================
        // JS GLOBAL AYARLAR (v9.94)
        // =======================================
        
        const DAY_NAMES = ['Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi', 'Pazar'];
        
        let currentOpenForm = null;
        let currentWeekOffset = 0;
        let draggedItem = null; 
        
        // YKS Geri Sayƒ±m Hedef Tarihi: 21 Haziran (2026 olarak varsayalƒ±m) saat 10:00
        const YKS_TYT_DATE = getNextYksDate(21, 5, 10, 0); // Ay 0'dan ba≈üladƒ±ƒüƒ± i√ßin Haziran=5

        // Pomodoro Deƒüi≈ükenleri
        let timerInterval = null;
        let initialSeconds = 25 * 60; 
        let isPaused = false;
        let isTimerRunning = false; 
        let expectedTime = null; 
        let remainingTimeOnPause = initialSeconds * 1000; 

        let audioPlayer;
        let musicVolume = parseInt(localStorage.getItem('musicVolume') || '15');
        
        // YKS Saya√ß Deƒüi≈ükenleri
        // Yarƒ±√ßap (r=30) kullanƒ±ldƒ±. √áevre: 2 * Math.PI * r
        const YKS_CIRCUMFERENCE = 2 * Math.PI * 30; 
        let yksInterval = null;

        // =======================================
        // INITIALIZATION
        // =======================================
        
        function getNextYksDate(day, month, hour, minute) {
            const today = new Date();
            let year = today.getFullYear();
            let targetDate = new Date(year, month, day, hour, minute, 0);

            // Eƒüer hedef tarih bug√ºnden √∂nceyse, bir sonraki yƒ±la bak.
            if (targetDate <= today) {
                targetDate = new Date(year + 1, month, day, hour, minute, 0);
            }
            return targetDate;
        }

        function createDayCells() {
             const grid = document.querySelector('.schedule-grid');
             if (!grid) return;

             let htmlContent = '';
             for (let i = 0; i < 7; i++) {
                 htmlContent += `
                     <div id="day-${i}" class="day-cell">
                         <h2 style="font-size: 1.5em; font-weight: 700; color: var(--day-header-color); text-align: center; border-bottom: 2px solid var(--border-color); padding-bottom: 5px; margin-bottom: 10px;">${DAY_NAMES[i]} <span id="date-${i}" style="font-size: 0.6em; font-weight: 400; opacity: 0.7;"></span></h2>
                         <div id="score-${i}" class="study-score-header" style=" font-size: 1.1em; font-weight: 700; color: var(--pomodoro-accent); margin: 5px 0 10px 0; text-align: center;">√áalƒ±≈üma: 0 dk</div>
                         
                         <div class="day-progress-area" id="progress-area-${i}">
                            <div class="day-progress-container">
                                <span class="day-progress-percentage" id="progress-percent-${i}">0%</span>
                                <div class="day-progress-fill" id="progress-fill-${i}" style="width: 0%;"></div>
                            </div>
                         </div>
                         <div class="cell-content-wrapper">
                             <ul class="task-list" data-day-index="${i}"></ul>
                             
                             <div class="add-task-form" id="form-${i}" style="padding: 10px 0; display: none; display: flex; gap: 5px; align-items: center;">
                                 <input type="text" placeholder="G√∂revi buraya yazƒ±n..." id="input-${i}" onkeydown="if(event.key === 'Enter') addTask(${i}, this.value)" style="flex-grow: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--task-bg); color: var(--text-color);">
                                 <button onclick="addTask(${i}, document.getElementById('input-${i}').value)" style="padding: 8px 10px; background-color: var(--accent-color);">EKLE</button>
                             </div>
                             <button class="add-task-btn" onclick="showAddTaskForm(${i})" style="background-color: var(--button-bg);">+ G√∂rev Ekle</button>
                         </div>
                     </div>
                 `;
             }
             grid.innerHTML = htmlContent;
        }

        document.addEventListener('DOMContentLoaded', () => {
            createDayCells(); 
            
            audioPlayer = document.getElementById('audio-player');
            audioPlayer.volume = musicVolume / 100;

            loadTheme();
            loadWeekFromURL();
            renderSchedule();
            loadPomodoroState();
            
            // YENƒ∞: YKS Sayacƒ±nƒ± Ba≈ülat
            startYksCountdown();

            document.getElementById('study-hours').addEventListener('input', updateTimerFromInputsAndReset);
            document.getElementById('study-minutes').addEventListener('input', updateTimerFromInputsAndReset);
            document.getElementById('study-seconds').addEventListener('input', updateTimerFromInputsAndReset);

            document.addEventListener('click', function(e) {
                if (currentOpenForm && 
                    !currentOpenForm.contains(e.target) && 
                    !e.target.classList.contains('add-task-btn') &&
                    !e.target.closest('.task-item')) { 
                    closeOpenForm();
                }
            });
            
            setupDragAndDropListeners();
        });

        // =======================================
        // YKS GERƒ∞ SAYIM SAYACI FONKSƒ∞YONLARI (YATAY D√úZEN ƒ∞√áƒ∞N G√úNCELLENDƒ∞)
        // =======================================
        
        function startYksCountdown() {
            updateYksCountdown(); 
            if (yksInterval) clearInterval(yksInterval);
            yksInterval = setInterval(updateYksCountdown, 1000);
            
            // Hedef tarihi kullanƒ±cƒ±ya g√∂sterelim
            const targetStr = YKS_TYT_DATE.toLocaleDateString('tr-TR', { day: 'numeric', month: 'long', year: 'numeric' });
            document.getElementById('yks-target-date').textContent = `Hedef: ${targetStr} @ 10:00`;
        }

        function updateYksCountdown() {
            const now = new Date();
            const distance = YKS_TYT_DATE.getTime() - now.getTime();

            if (distance < 0) {
                clearInterval(yksInterval);
                const container = document.getElementById('yks-countdown-container');
                if (container) {
                    container.innerHTML = `
                        <h2 style="color: var(--pomodoro-accent); margin: auto;">YKS GER√áEKLE≈ûTƒ∞! YENƒ∞ HEDEFLER BELƒ∞RLEME ZAMANI.</h2>
                    `;
                    container.style.justifyContent = 'center';
                }
                return;
            }

            // Geri Sayƒ±m Deƒüerleri
            const totalDays = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hoursLeft = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutesLeft = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const secondsLeft = Math.floor((distance % (1000 * 60)) / 1000);

            // DOM G√ºncelleme
            document.getElementById('days-value').textContent = totalDays;
            document.getElementById('hours-value').textContent = hoursLeft.toString().padStart(2, '0');
            document.getElementById('minutes-value').textContent = minutesLeft.toString().padStart(2, '0');
            document.getElementById('seconds-value').textContent = secondsLeft.toString().padStart(2, '0');

            // √áember G√ºncelleme (Azalan √áer√ßeve)
            
            // 1. Saniye √áemberi: Saniyeler azaldƒ±k√ßa √ßemberin doluluƒüu azalacak.
            const secondsRatio = secondsLeft / 60; // Kalan saniyenin 60'a oranƒ±
            setDashOffset('seconds-circle', secondsRatio);

            // 2. Dakika √áemberi: Kalan dakikanƒ±n 60'a oranƒ± + Saniyeyi ekle
            const minutesRatio = (minutesLeft + secondsRatio) / 60; 
            setDashOffset('minutes-circle', minutesRatio);

            // 3. Saat √áemberi: Kalan saatin 24'e oranƒ± + Dakikayƒ± ekle
            const hoursRatio = (hoursLeft + minutesRatio * 60 / 60) / 24; // Kalan saat + (kalan dakika/60)
            setDashOffset('hours-circle', hoursRatio);

            // 4. G√ºn √áemberi: Yƒ±lƒ±n bitmesine kalan s√ºrenin oranƒ± (G√ºn bazlƒ± d√∂ng√º)
            const nowYearStart = new Date(now.getFullYear(), 0, 1);
            const nextYearStart = new Date(now.getFullYear() + 1, 0, 1);
            const totalYearDays = (nextYearStart.getTime() - nowYearStart.getTime()) / (1000 * 60 * 60 * 24);
            const remainingYearDays = totalDays + (hoursLeft/24); 
            const yearRatio = remainingYearDays / totalYearDays;
            
            setDashOffset('days-circle', yearRatio);
        }
        
        function setDashOffset(elementId, ratio) {
            const circle = document.getElementById(elementId);
            if (circle) {
                // Ratio: 1=dolu (s√ºre √ßok), 0=bo≈ü (s√ºre bitti)
                // ƒ∞stenen: Kalan s√ºre azaldƒ±k√ßa √ßemberin doluluƒüu azalsƒ±n.
                // Offset = √áevre * (1 - ratio). Ratio azaldƒ±k√ßa offset b√ºy√ºr (bo≈üluk artar).
                
                circle.style.strokeDasharray = `${YKS_CIRCUMFERENCE} ${YKS_CIRCUMFERENCE}`;
                const offset = YKS_CIRCUMFERENCE * (1 - ratio); 
                circle.style.strokeDashoffset = offset; 
            }
        }
        
        // =======================================
        // TEMA Y√ñNETƒ∞Mƒ∞
        // =======================================
        function setTheme(themeName, button = null) {
            document.body.setAttribute('data-theme', themeName);
            localStorage.setItem('selectedTheme', themeName);

            const themeButtons = document.querySelectorAll('.theme-button');
            themeButtons.forEach(btn => btn.classList.remove('active'));

            if (button) {
                button.classList.add('active');
            } else {
                const savedButton = document.getElementById(`${themeName}-btn`);
                if(savedButton) savedButton.classList.add('active');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'default';
            setTheme(savedTheme); 
        }

        // =======================================
        // TARƒ∞H VE HAFTA Y√ñNETƒ∞Mƒ∞
        // =======================================
        
        function getStartOfWeek(date) {
            const day = date.getDay(); 
            const diff = date.getDate() - day + (day === 0 ? -6 : 1); 
            const startOfWeek = new Date(date);
            startOfWeek.setDate(diff);
            startOfWeek.setHours(0, 0, 0, 0); 
            return startOfWeek;
        }

        function calculateWeekStart(offset) {
            const today = new Date();
            const startOfWeek = getStartOfWeek(today);
            const targetDate = new Date(startOfWeek);
            targetDate.setDate(startOfWeek.getDate() + (offset * 7));
            return targetDate;
        }

        function renderSchedule() {
            const weekStart = calculateWeekStart(currentWeekOffset);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            const weekStartStr = weekStart.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' });
            const weekEndStr = weekEnd.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short', year: 'numeric' });
            
            const weekInfoElement = document.getElementById('week-info');
            if (weekInfoElement) {
                weekInfoElement.textContent = `${weekStartStr} - ${weekEndStr}`;
            }

            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(weekStart);
                dayDate.setDate(weekStart.getDate() + i);
                
                const dateElement = document.getElementById(`date-${i}`);
                if (dateElement) {
                    dateElement.textContent = dayDate.toLocaleDateString('tr-TR', { day: 'numeric', month: 'numeric' });
                }
                renderTasks(i);
                updateDayProgress(i); 
            }
            
            renderStudyScores();
            updateWeeklyTotalTime(); 
            updateURL();
        }

        function changeWeek(direction) {
            currentWeekOffset += direction;
            renderSchedule();
        }
        
        function updateURL() {
            const url = new URL(window.location);
            url.searchParams.set('week', currentWeekOffset);
            window.history.pushState({}, '', url);
        }

        function loadWeekFromURL() {
            const params = new URLSearchParams(window.location.search);
            const week = params.get('week');
            if (week !== null) {
                currentWeekOffset = parseInt(week) || 0;
            }
        }
        
        // =======================================
        // G√ñREV Y√ñNETƒ∞Mƒ∞ VE ƒ∞LERLEME
        // =======================================
        
        function getStorageKey(dayIndex) {
            return `tasks_week_${currentWeekOffset}_day_${dayIndex}`;
        }
        
        function getStorageKeyByOffset(weekOffset, dayIndex) {
            return `tasks_week_${weekOffset}_day_${dayIndex}`;
        }

        function loadTasks(dayIndex) {
            const key = getStorageKey(dayIndex);
            const tasksJson = localStorage.getItem(key);
            return tasksJson ? JSON.parse(tasksJson) : []; 
        }

        function saveTasks(dayIndex, tasks) {
            const key = getStorageKey(dayIndex);
            localStorage.setItem(key, JSON.stringify(tasks));
            updateDayProgress(dayIndex); 
        }
        
        function updateDayProgress(dayIndex) {
            const tasks = loadTasks(dayIndex);
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;

            const percentage = totalTasks === 0 ? 0 : Math.round((completedTasks / totalTasks) * 100);

            const fillElement = document.getElementById(`progress-fill-${dayIndex}`);
            const percentElement = document.getElementById(`progress-percent-${dayIndex}`);

            if (fillElement && percentElement) {
                fillElement.style.width = `${percentage}%`;
                percentElement.textContent = `${percentage}%`;

                if (percentage === 100 && totalTasks > 0) {
                    fillElement.classList.add('complete');
                } else {
                    fillElement.classList.remove('complete');
                }
            }
        }
        
        function renderTasks(dayIndex) {
            const taskList = document.querySelector(`#day-${dayIndex} .task-list`);
            if (!taskList) return;

            taskList.innerHTML = '';
            const tasks = loadTasks(dayIndex);
            
            tasks.forEach(task => createTaskElement(taskList, dayIndex, task.text, task.completed));
        }

        function createTaskElement(taskList, dayIndex, text, completed = false) {
            const listItem = document.createElement('li');
            listItem.className = 'task-item' + (completed ? ' completed' : '');
            listItem.draggable = true; 
            listItem.setAttribute('data-task-text', text); 

            // Drag/Drop Listeners
            listItem.addEventListener('dragstart', (e) => {
                draggedItem = listItem;
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', text); 
                setTimeout(() => listItem.classList.add('dragging'), 0);
            });
            listItem.addEventListener('dragend', () => {
                if (draggedItem) {
                     draggedItem.classList.remove('dragging');
                     draggedItem = null;
                }
                reorderTasksInStorage(dayIndex); 
            });

            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'task-content-wrapper';

            const taskSpan = document.createElement('span');
            taskSpan.textContent = text;
            taskSpan.className = 'task-text-content';

            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'task-actions';
            actionsDiv.style.display = 'flex';
            actionsDiv.style.alignItems = 'center';
            actionsDiv.style.gap = '5px';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'task-checkbox';
            checkbox.checked = completed;
            checkbox.style.transform = 'scale(1.2)';

            checkbox.addEventListener('change', function() {
                const newCompleted = this.checked;
                
                listItem.classList.toggle('completed', newCompleted);
                
                updateTaskCompletion(dayIndex, text, newCompleted); 
            });
            
            const moveButton = document.createElement('button');
            moveButton.innerHTML = '<i class="fas fa-arrow-right"></i>'; 
            moveButton.className = 'move-btn';
            moveButton.style.padding = '5px';
            moveButton.style.borderRadius = '4px';
            moveButton.style.background = 'none';
            moveButton.style.color = 'var(--accent-color)';
            
            moveButton.onclick = function(e) {
                 e.stopPropagation(); 
                 moveTaskToNextDay(dayIndex, text);
            };

            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = '<i class="fas fa-trash-alt"></i>';
            deleteButton.className = 'delete-btn';
            deleteButton.style.background = 'none';
            deleteButton.style.color = 'var(--pomodoro-accent)';
            deleteButton.style.fontSize = '1.1em';
            deleteButton.style.padding = '0 5px';
            
            deleteButton.onclick = function(e) {
                 e.stopPropagation(); 
                 deleteTaskFromStorage(dayIndex, text);
                 listItem.remove();
            };

            actionsDiv.appendChild(checkbox);
            actionsDiv.appendChild(moveButton); 
            
            contentWrapper.appendChild(actionsDiv);
            contentWrapper.appendChild(taskSpan);
            contentWrapper.appendChild(deleteButton);
            
            listItem.appendChild(contentWrapper);
            
            taskList.appendChild(listItem);
        }
        
        function reorderTasksInStorage(dayIndex) {
            const taskList = document.querySelector(`#day-${dayIndex} .task-list`);
            if (!taskList) return;

            const reorderedTasks = [];
            const taskElements = taskList.querySelectorAll('.task-item');
            
            const existingTasks = loadTasks(dayIndex);

            taskElements.forEach(item => {
                const taskText = item.getAttribute('data-task-text');
                const existingTask = existingTasks.find(t => t.text === taskText);
                
                if (existingTask) {
                    reorderedTasks.push(existingTask);
                }
            });
            saveTasks(dayIndex, reorderedTasks);
        }
        
        function addTask(dayIndex, text) {
            const inputText = text.trim();
            if (inputText === "") {
                showCustomAlert("L√ºtfen bir g√∂rev girin.");
                return;
            }
            
            let tasks = loadTasks(dayIndex);
            if (tasks.some(t => t.text === inputText)) {
                 showCustomAlert("Bu g√∂rev zaten listede var.");
                 return;
            }

            tasks.push({ text: inputText, completed: false });
            saveTasks(dayIndex, tasks); 
            
            const taskList = document.querySelector(`#day-${dayIndex} .task-list`);
            if (taskList) {
                createTaskElement(taskList, dayIndex, inputText, false);
            }
            
            const inputElement = document.getElementById(`input-${dayIndex}`);
            if(inputElement) inputElement.value = '';
            closeOpenForm();
        }

        function updateTaskCompletion(dayIndex, text, completed) {
            let tasks = loadTasks(dayIndex);
            const taskIndex = tasks.findIndex(t => t.text === text);
            if (taskIndex !== -1) {
                tasks[taskIndex].completed = completed;
                saveTasks(dayIndex, tasks); 
            }
        }
        
        function deleteTaskFromStorage(dayIndex, text) {
            let tasks = loadTasks(dayIndex);
            tasks = tasks.filter(task => task.text !== text);
            saveTasks(dayIndex, tasks);
        }
        
        function moveTaskToNextDay(currentDayIndex, taskText) {
            let currentTasks = loadTasks(currentDayIndex);
            const taskToMove = currentTasks.find(task => task.text === taskText);
            
            if (!taskToMove) return;

            currentTasks = currentTasks.filter(task => task.text !== taskText);
            saveTasks(currentDayIndex, currentTasks);
            
            let nextDayIndex = (currentDayIndex + 1) % 7;
            let targetWeekOffset = currentWeekOffset + (currentDayIndex === 6 ? 1 : 0);

            const nextDayKey = getStorageKeyByOffset(targetWeekOffset, nextDayIndex);

            let nextTasks = JSON.parse(localStorage.getItem(nextDayKey) || '[]');
            
            if (!nextTasks.some(t => t.text === taskText)) {
                 taskToMove.completed = false; 
                 nextTasks.push(taskToMove);
                 localStorage.setItem(nextDayKey, JSON.stringify(nextTasks));
            }

            renderSchedule(); 
            showCustomAlert(`G√∂rev "${taskText}" bir sonraki g√ºne ta≈üƒ±ndƒ±.`, '#38bdf8');
        }

        function showAddTaskForm(dayIndex) {
            const form = document.getElementById(`form-${dayIndex}`);
            const button = document.querySelector(`#day-${dayIndex} .add-task-btn`);
            
            if (currentOpenForm && currentOpenForm !== form) {
                closeOpenForm();
            }
            
            if (form) {
                 const isVisible = form.style.display === 'flex';
                 form.style.display = isVisible ? 'none' : 'flex';
                 if (!isVisible) {
                    document.getElementById(`input-${dayIndex}`).focus();
                    currentOpenForm = form;
                    if(button) button.style.display = 'none';
                 } else {
                     currentOpenForm = null;
                     if(button) button.style.display = 'block';
                 }
            }
        }
        
        function closeOpenForm() {
            if (currentOpenForm) {
                currentOpenForm.style.display = 'none';
                const dayIndex = currentOpenForm.id.split('-')[1];
                const button = document.querySelector(`#day-${dayIndex} .add-task-btn`);
                if(button) button.style.display = 'block';
                currentOpenForm = null;
            }
        }
        
        // =======================================
        // DRAG AND DROP (S√úR√úKLE BIRAK)
        // =======================================
        
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        function handleDragOver(e) {
            e.preventDefault(); 
            const currentList = e.currentTarget;
            if (!draggedItem) return; 
            
            const afterElement = getDragAfterElement(currentList, e.clientY);
            if (afterElement == null) {
                currentList.appendChild(draggedItem);
            } else {
                currentList.insertBefore(draggedItem, afterElement);
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            if (!draggedItem) return;
            const currentList = e.currentTarget;
            const currentDayIndex = parseInt(currentList.dataset.dayIndex);
            
            reorderTasksInStorage(currentDayIndex); 
            
            draggedItem.classList.remove('dragging');
            draggedItem = null;
        }

        function setupDragAndDropListeners() {
            const taskLists = document.querySelectorAll('.task-list');
            taskLists.forEach(list => {
                list.addEventListener('dragover', handleDragOver);
                list.addEventListener('drop', handleDrop);
            });
        }
        
        // =======================================
        // POMODORO VE S√úRE Y√ñNETƒ∞Mƒ∞
        // =======================================
        
        function savePomodoroState() {
            const state = {
                isRunning: isTimerRunning,
                isPaused: isPaused,
                initialSeconds: initialSeconds,
                remainingTime: isTimerRunning ? expectedTime - Date.now() : remainingTimeOnPause,
                timestamp: Date.now()
            };
            localStorage.setItem('pomodoroState', JSON.stringify(state));
        }

        function loadPomodoroState() {
            const stateJson = localStorage.getItem('pomodoroState');
            if (!stateJson) {
                updateTimerDisplay(initialSeconds * 1000); 
                return;
            }

            const state = JSON.parse(stateJson);
            initialSeconds = state.initialSeconds || 25 * 60;
            
            const hours = Math.floor(initialSeconds / 3600);
            const minutes = Math.floor((initialSeconds % 3600) / 60);
            const seconds = initialSeconds % 60;
            
            const studyHours = document.getElementById('study-hours');
            if(studyHours) studyHours.value = hours;
            const studyMinutes = document.getElementById('study-minutes');
            if(studyMinutes) studyMinutes.value = minutes;
            const studySeconds = document.getElementById('study-seconds');
            if(studySeconds) studySeconds.value = seconds;

            if (state.isRunning && !state.isPaused) {
                const elapsedSinceSave = Date.now() - state.timestamp;
                remainingTimeOnPause = state.remainingTime - elapsedSinceSave;
                
                if (remainingTimeOnPause <= 1000) { 
                    resetTimer(true, true);
                    finishTimer(true); 
                    return;
                }

                isTimerRunning = true;
                isPaused = false;
                expectedTime = Date.now() + remainingTimeOnPause;
                startInterval();
                disableTimerInputs(true);
            } else {
                isTimerRunning = state.isRunning;
                isPaused = state.isPaused;
                remainingTimeOnPause = state.remainingTime;
                updateTimerDisplay(remainingTimeOnPause);
            }
        }
        
        function startInterval() {
            if(timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => updateTimerDisplay(null, true), 100); 
        }

        function updateTimerFromInputs() {
            const hours = getInputValue('study-hours');
            const minutes = getInputValue('study-minutes');
            const seconds = getInputValue('study-seconds');
            
            const newInitialSeconds = (hours * 3600) + (minutes * 60) + seconds;
            initialSeconds = Math.max(0, newInitialSeconds);
        }

        function updateTimerFromInputsAndReset() {
            if (isTimerRunning) return; 
            updateTimerFromInputs();
            resetTimer(true, false); 
            savePomodoroState();
        }

        function showPomodoroModal() {
            const modal = document.getElementById('pomodoro-modal');
            modal.style.display = 'flex';
            
            const startBtn = document.getElementById('start-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const statusText = document.getElementById('timer-status');

            if (isTimerRunning && !isPaused) {
                if(startBtn) { startBtn.style.display = 'none'; startBtn.style.opacity = '0'; startBtn.style.visibility = 'hidden'; }
                if(pauseBtn) { pauseBtn.style.display = 'flex'; pauseBtn.style.opacity = '1'; pauseBtn.style.visibility = 'visible'; }
                if(statusText) statusText.textContent = "√áALI≈ûIYOR...";
            } else {
                if(startBtn) { startBtn.style.display = 'flex'; startBtn.style.opacity = '1'; startBtn.style.visibility = 'visible'; }
                if(pauseBtn) { pauseBtn.style.display = 'none'; pauseBtn.style.opacity = '0'; pauseBtn.style.visibility = 'hidden'; }
                if(statusText) statusText.textContent = isPaused ? "DURAKLATILDI" : "Hazƒ±r.";
            }
            updateTimerDisplay(remainingTimeOnPause);
        }

        function hidePomodoroModal() {
            document.getElementById('pomodoro-modal').style.display = 'none';
        }

        function formatTime(totalSeconds) {
            totalSeconds = Math.max(0, totalSeconds || 0); 
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateTimerDisplay(msOverride = null, fromInterval = false) {
            let remainingMs;

            if (msOverride !== null) {
                remainingMs = msOverride;
            } else if (isPaused) {
                remainingMs = remainingTimeOnPause;
            } else if (isTimerRunning) {
                remainingMs = expectedTime - Date.now();
            } else {
                remainingMs = initialSeconds * 1000;
            }
            
            if (isTimerRunning && remainingMs <= 100) {
                clearInterval(timerInterval);
                finishTimer(true); 
                return;
            }
            
            remainingTimeOnPause = remainingMs; 
            const totalSeconds = Math.ceil(remainingMs / 1000);

            const timerDisplay = document.getElementById('timer-display');
            if(timerDisplay) timerDisplay.textContent = formatTime(totalSeconds); 
            
            if (fromInterval) {
                 savePomodoroState();
            }
        }

        function startTimer() {
            updateTimerFromInputs(); 
            
            if (initialSeconds <= 0) {
                 showCustomAlert("√áalƒ±≈üma s√ºresi 1 saniyeden az olamaz.");
                 return;
            }
            
            if (isTimerRunning && !isPaused) return; 
            
            disableTimerInputs(true);

            const statusText = document.getElementById('timer-status');
            if(statusText) statusText.textContent = "√áALI≈ûIYOR...";
            
            const startBtn = document.getElementById('start-btn');
            const pauseBtn = document.getElementById('pause-btn');

            if(startBtn) { startBtn.style.display = 'none'; startBtn.style.opacity = '0'; startBtn.style.visibility = 'hidden'; }
            if(pauseBtn) { pauseBtn.style.display = 'flex'; pauseBtn.style.opacity = '1'; pauseBtn.style.visibility = 'visible'; }
            
            if (!isTimerRunning) {
                remainingTimeOnPause = initialSeconds * 1000; 
            }
            
            expectedTime = Date.now() + remainingTimeOnPause;

            isTimerRunning = true;
            isPaused = false;
            
            startInterval();
            updateTimerDisplay();
        }

        function pauseTimer() {
            if (!isTimerRunning || isPaused) return;

            clearInterval(timerInterval);
            isPaused = true;
            
            const statusText = document.getElementById('timer-status');
            if(statusText) statusText.textContent = "DURAKLATILDI";
            
            const startBtn = document.getElementById('start-btn');
            const pauseBtn = document.getElementById('pause-btn');

            if(startBtn) { startBtn.style.display = 'flex'; startBtn.style.opacity = '1'; startBtn.style.visibility = 'visible'; }
            if(pauseBtn) { pauseBtn.style.display = 'none'; pauseBtn.style.opacity = '0'; pauseBtn.style.visibility = 'hidden'; }
            
            savePomodoroState();
            updateTimerDisplay(); 
        }

        function finishTimer(isCompleted = false) {
            clearInterval(timerInterval);
            
            const initialMs = initialSeconds * 1000;
            const remainingMs = Math.max(0, remainingTimeOnPause);
            const workedTimeMs = initialMs - remainingMs;
            
            const workedMinutes = Math.round(workedTimeMs / 60000); 
            
            isTimerRunning = false;
            isPaused = false;

            if (workedMinutes > 0) {
                const dayIndex = (new Date().getDay() + 6) % 7; 
                const dayName = DAY_NAMES[dayIndex];
                
                saveStudyScore(dayIndex, workedMinutes); 
                
                const formattedScore = formatMinutesToHoursMinutes(workedMinutes);
                let message;
                if (isCompleted) {
                    message = `Tebrikler, √ñmer! ${formattedScore} √ßalƒ±≈üma ba≈üarƒ±yla tamamlandƒ± ve ${dayName} g√ºn√ºne kaydedildi.`;
                } else {
                    message = `√ñmer, ${formattedScore} √ßalƒ±≈üma ${dayName} g√ºn√ºne kaydedildi.`;
                }
                
                showCustomAlert(message, '#38bdf8');
            } else if (!isCompleted && initialSeconds > 0) {
                 showCustomAlert("√áok kƒ±sa √ßalƒ±≈ütƒ±nƒ±z, s√ºre kaydedilmedi.");
            }
            
            resetTimer(true, true); 
            hidePomodoroModal(); 
            localStorage.removeItem('pomodoroState');
        }

        function resetTimer(clearIntervalFlag = true, enableInputs = true) {
            if (clearIntervalFlag) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            isTimerRunning = false;
            isPaused = false;
            
            disableTimerInputs(!enableInputs); 
            
            if (enableInputs) {
                updateTimerFromInputs(); 
            }
            
            remainingTimeOnPause = initialSeconds * 1000; 
            
            const timerDisplay = document.getElementById('timer-display');
            if(timerDisplay) timerDisplay.textContent = formatTime(initialSeconds); 
            
            const statusText = document.getElementById('timer-status');
            if(statusText) statusText.textContent = "Hazƒ±r.";
            
            const startBtn = document.getElementById('start-btn');
            const pauseBtn = document.getElementById('pause-btn');
            if(startBtn) { startBtn.style.display = 'flex'; startBtn.style.opacity = '1'; startBtn.style.visibility = 'visible'; }
            if(pauseBtn) { pauseBtn.style.display = 'none'; pauseBtn.style.opacity = '0'; pauseBtn.style.visibility = 'hidden'; }

            localStorage.removeItem('pomodoroState');
        }
        
        function disableTimerInputs(disabled) {
            const hours = document.getElementById('study-hours');
            if(hours) hours.disabled = disabled;
            const minutes = document.getElementById('study-minutes');
            if(minutes) minutes.disabled = disabled;
            const seconds = document.getElementById('study-seconds');
            if(seconds) seconds.disabled = disabled;
        }

        // =======================================
        // PUAN VE S√úRE HESAPLAMALARI
        // =======================================
        
        function getStudyScoreKey() {
            return `study_scores_week_${currentWeekOffset}`;
        }
        
        function loadStudyScores() {
            const key = getStudyScoreKey();
            const scoresJson = localStorage.getItem(key);
            return scoresJson ? JSON.parse(scoresJson) : [0, 0, 0, 0, 0, 0, 0];
        }
        
        function saveStudyScore(dayIndex, minutes) {
            const scores = loadStudyScores();
            scores[dayIndex] += minutes;
            const key = getStudyScoreKey();
            localStorage.setItem(key, JSON.stringify(scores));
            renderStudyScores();
            updateWeeklyTotalTime(); 
        }
        
        function formatMinutesToHoursMinutes(totalMinutes) {
            if (totalMinutes < 1) return `0 dk`;
            if (totalMinutes < 60) return `${totalMinutes} dk`;
            
            const hours = Math.floor(totalMinutes / 60);
            const minutes = Math.round(totalMinutes % 60); 
            
            if (minutes === 0) return `${hours} sa`;
            return `${hours} sa ${minutes} dk`;
        }

        function updateWeeklyTotalTime() {
             const scores = loadStudyScores();
             const totalMinutes = scores.reduce((sum, current) => sum + current, 0);
             const weeklyDisplay = document.getElementById('weekly-total-time');
             if (weeklyDisplay) {
                 weeklyDisplay.textContent = `HAFTA: ${formatMinutesToHoursMinutes(totalMinutes)}`;
             }
        }

        function renderStudyScores() {
            const scores = loadStudyScores();
            const todayIndex = (new Date().getDay() + 6) % 7; 
            let todayWorkedMinutes = 0;

            for (let i = 0; i < 7; i++) {
                const scoreArea = document.getElementById(`score-${i}`);
                const scoreMinutes = scores[i]; 
                
                if(i === todayIndex) {
                    todayWorkedMinutes = scoreMinutes;
                }
                
                if (scoreArea) {
                    scoreArea.textContent = `√áalƒ±≈üma: ${formatMinutesToHoursMinutes(scoreMinutes)}`;
                }
            }
            
            const todayWorkedDisplay = document.getElementById('today-worked-time');
            if (todayWorkedDisplay) {
                todayWorkedDisplay.textContent = `BUG√úN: ${formatMinutesToHoursMinutes(todayWorkedMinutes)}`;
            }
        }
        
        // =======================================
        // HELPER FONKSƒ∞YONLAR & UYARI
        // =======================================
        function getInputValue(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return 0;
            const value = element.value;
            return parseInt(value) || 0; 
        }

        function showCustomAlert(message, backgroundColor = '#ef4444') {
            const alertBox = document.getElementById('custom-alert');
            if (!alertBox) return;
            
            alertBox.style.backgroundColor = backgroundColor;
            alertBox.textContent = message;
            alertBox.style.opacity = '1';
            alertBox.style.top = '30px'; 

            setTimeout(() => {
                alertBox.style.opacity = '0';
                alertBox.style.top = '-50px'; 
            }, 4000);
        }

    </script>
</body>
</html>
